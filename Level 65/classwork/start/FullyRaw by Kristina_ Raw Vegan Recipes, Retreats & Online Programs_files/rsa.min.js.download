var rudderanalytics=function(e){"use strict";function t(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function n(e){return function n(i){return 0===arguments.length||t(i)?n:e.apply(this,arguments)}}function i(e){return function i(r,s){switch(arguments.length){case 0:return i;case 1:return t(r)?i:n((function(t){return e(r,t)}));default:return t(r)&&t(s)?i:t(r)?n((function(t){return e(t,s)})):t(s)?n((function(t){return e(r,t)})):e(r,s)}}}function r(e){return function r(s,o,a){switch(arguments.length){case 0:return r;case 1:return t(s)?r:i((function(t,n){return e(s,t,n)}));case 2:return t(s)&&t(o)?r:t(s)?i((function(t,n){return e(t,o,n)})):t(o)?i((function(t,n){return e(s,t,n)})):n((function(t){return e(s,o,t)}));default:return t(s)&&t(o)&&t(a)?r:t(s)&&t(o)?i((function(t,n){return e(t,n,a)})):t(s)&&t(a)?i((function(t,n){return e(t,o,n)})):t(o)&&t(a)?i((function(t,n){return e(s,t,n)})):t(s)?n((function(t){return e(t,o,a)})):t(o)?n((function(t){return e(s,t,a)})):t(a)?n((function(t){return e(s,o,t)})):e(s,o,a)}}}function s(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var o=n((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function a(e){return"[object Object]"===Object.prototype.toString.call(e)}const l=Number.isInteger||function(e){return(e|0)===e};function u(e,t){var n,i=e<0?t.length+e:e;return n=t,"[object String]"===Object.prototype.toString.call(n)?t.charAt(i):t[i]}function c(e,t,n){if(n||(n=new d),function(e){var t=typeof e;return null==e||"object"!=t&&"function"!=t}(e))return e;var i,r=function(t){var i=n.get(e);if(i)return i;for(var r in n.set(e,t),e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=c(e[r],!0,n));return t};switch(o(e)){case"Object":return r(Object.create(Object.getPrototypeOf(e)));case"Array":return r(Array(e.length));case"Date":return new Date(e.valueOf());case"RegExp":return i=e,new RegExp(i.source,i.flags?i.flags:(i.global?"g":"")+(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.sticky?"y":"")+(i.unicode?"u":"")+(i.dotAll?"s":""));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return e.slice();default:return e}}var d=function(){function e(){this.map={},this.length=0}return e.prototype.set=function(e,t){var n=this.hash(e),i=this.map[n];i||(this.map[n]=i=[]),i.push([e,t]),this.length+=1},e.prototype.hash=function(e){var t=[];for(var n in e)t.push(Object.prototype.toString.call(e[n]));return t.join()},e.prototype.get=function(e){if(this.length<=180)for(var t in this.map)for(var n=this.map[t],i=0;i<n.length;i+=1){if((s=n[i])[0]===e)return s[1]}else{var r=this.hash(e);if(n=this.map[r])for(i=0;i<n.length;i+=1){var s;if((s=n[i])[0]===e)return s[1]}}},e}(),g=n((function(e){return null!=e&&"function"==typeof e.clone?e.clone():c(e)}));function h(e,t){for(var n=t,i=0;i<e.length;i+=1){if(null==n)return;var r=e[i];n=l(r)?u(r,n):n[r]}return n}var p=r((function(e,t,n){var i,r={};for(i in n=n||{},t=t||{})s(i,t)&&(r[i]=s(i,n)?e(i,t[i],n[i]):t[i]);for(i in n)s(i,n)&&!s(i,r)&&(r[i]=n[i]);return r})),v=r((function e(t,n,i){return p((function(n,i,r){return a(i)&&a(r)?e(t,i,r):t(n,i,r)}),n,i)})),f=r((function(e,t,n){return v((function(t,n,i){return e(n,i)}),t,n)})),y=i(h),m=i((function(e,t){var n={};for(var i in t)e(t[i],i,t)&&(n[i]=t[i]);return n}));const b=e=>"function"==typeof e&&Boolean(e.constructor&&e.call&&e.apply),E=e=>"string"==typeof e,k=e=>null===e,S=e=>void 0===e,I=e=>k(e)||S(e),T=e=>!S(e),w=e=>!I(e),A=e=>e instanceof Error,P=(e,t)=>{const n=t.split(".");return y(n,e)},C=e=>!k(e)&&"object"==typeof e&&!Array.isArray(e),D=e=>!k(e)&&"[object Object]"===Object.prototype.toString.call(e),$=(e,t)=>{if(!Array.isArray(e)||!Array.isArray(t))return g(t);const n=g(e);return t.forEach(((e,t)=>{n[t]=Array.isArray(e)||C(e)?R(n[t],e):e})),n},R=(e,t)=>f($,e,t),O=e=>D(e)&&Object.keys(e).length>0,L=e=>{const t=m(T,e);return Object.keys(t).forEach((e=>{const n=t[e];D(n)&&(t[e]=L(n))})),t},M=e=>{const t=m(w,e);return Object.keys(t).forEach((e=>{const n=t[e];D(n)&&(t[e]=M(n))})),t},B=e=>e.replace(/^\.+/,""),N=e=>{let t=e;if(!E(e)&&!I(e))try{t=JSON.stringify(e)}catch(e){t=null}return t},U=e=>(e=>{const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return globalThis.btoa(t)})((new TextEncoder).encode(e)),x=(e,t,n,i,r)=>{const s={category:e,name:t,properties:n,options:i,callback:void 0};b(r)&&(s.callback=r),b(i)&&(s.category=e,s.name=t,s.properties=n,s.options=void 0,s.callback=i),b(n)&&(s.category=e,s.name=t,s.properties=void 0,s.options=void 0,s.callback=n),b(t)&&(s.category=e,s.name=void 0,s.properties=void 0,s.options=void 0,s.callback=t),b(e)&&(s.category=void 0,s.name=void 0,s.properties=void 0,s.options=void 0,s.callback=e),D(e)?(s.name=void 0,s.category=void 0,s.properties=e,b(t)?s.options=void 0:s.options=t):D(t)&&(s.name=void 0,s.properties=t,b(n)?s.options=void 0:s.options=n),E(e)&&!E(t)&&(s.category=void 0,s.name=e),T(s.category)||(s.category=void 0),T(s.name)||(s.name=void 0),s.properties=s.properties?g(s.properties):{},T(s.options)?s.options=g(s.options):s.options=void 0;const o=E(s.name)?s.name:s.properties.name,a=E(s.category)?s.category:s.properties.category;return s.properties=R(D(s.properties)?s.properties:{},{...o&&{name:o},...a&&{category:a}}),s},j=(e,t,n,i)=>{const r={name:e,properties:t,options:n,callback:void 0};return b(i)&&(r.callback=i),b(n)&&(r.properties=t,r.options=void 0,r.callback=n),b(t)&&(r.properties=void 0,r.options=void 0,r.callback=t),r.properties=w(r.properties)?g(r.properties):{},T(r.options)?r.options=g(r.options):r.options=void 0,r},H=(e,t,n,i)=>{const r={userId:e,traits:t,options:n,callback:void 0};return b(i)&&(r.callback=i),b(n)&&(r.userId=e,r.traits=t,r.options=void 0,r.callback=n),b(t)&&(r.userId=e,r.traits=void 0,r.options=void 0,r.callback=t),(D(e)||k(e))&&(r.userId=null,r.traits=e,b(t)?r.options=void 0:r.options=t),r.userId=N(r.userId),D(r.traits)?r.traits=g(r.traits):r.traits=void 0,T(r.options)?r.options=g(r.options):r.options=void 0,r},_=(e,t,n,i)=>{const r={to:e,from:t,options:n,callback:void 0};return b(i)&&(r.callback=i),b(n)&&(r.to=e,r.from=t,r.options=void 0,r.callback=n),b(t)?(r.to=e,r.from=void 0,r.options=void 0,r.callback=t):(D(t)||k(t))&&(r.to=e,r.from=void 0,r.options=t),T(r.to)&&(r.to=N(r.to)),T(r.from)?r.from=N(r.from):r.from=void 0,T(r.options)?r.options=g(r.options):r.options=void 0,r},F=(e,t,n,i)=>{const r={groupId:e,traits:t,options:n,callback:void 0};return b(i)&&(r.callback=i),b(n)&&(r.groupId=e,r.traits=t,r.options=void 0,r.callback=n),b(t)&&(r.groupId=e,r.traits=void 0,r.options=void 0,r.callback=t),(D(e)||k(e))&&(r.groupId=null,r.traits=e,b(t)?r.options=void 0:r.options=t),r.groupId=N(r.groupId),D(r.traits)?r.traits=g(r.traits):r.traits=void 0,T(r.options)?r.options=g(r.options):r.options=void 0,r};let Q=function(e){return e.LOADED="Page Loaded",e.UNLOADED="Page Unloaded",e}({});const K="CapabilitiesManager",G="ConfigManager",z="EventManager",V="PluginsManager",q="UserSessionManager",W="ErrorHandler",J="PluginEngine",X="StoreManager",Z="RudderStackApplication",Y="AnalyticsCore";for(var ee,te=[],ne=0;ne<256;ne++)te[ne]=(ne+256).toString(16).substring(1);function ie(){var e;(!ee||ne+16>4096)&&(e=4096,ee=crypto.getRandomValues(new Uint8Array(e)),ne=0);for(var t,n=0,i="";n<16;n++)t=ee[ne+n],i+=6==n?te[15&t|64]:8==n?te[63&t|128]:te[t],1&n&&n>1&&n<11&&(i+="-");return ne+=16,i}for(var re,se=256,oe=[];se--;)oe[se]=(se+256).toString(16).substring(1);const ae=()=>!I(globalThis.crypto)&&b(globalThis.crypto.getRandomValues)?ie():function(){var e,t=0,n="";if(!re||se+16>256){for(re=Array(t=256);t--;)re[t]=256*Math.random()|0;t=se=0}for(;t<16;t++)e=re[se+t],n+=6==t?oe[15&e|64]:8==t?oe[63&e|128]:oe[e],1&t&&t>1&&t<11&&(n+="-");return se++,n}(),le=e=>e.toISOString(),ue="RudderLabs JavaScript SDK",ce="3.10.1",de="RudderJS-Initiated",ge="preloadedEventsBuffer",he="ajs_aid",pe="ajs_uid",ve="ajs_event",fe=18e5,ye=(e="app")=>{globalThis.RudderStackGlobals||(globalThis.RudderStackGlobals={}),globalThis.RudderStackGlobals[e]||(globalThis.RudderStackGlobals[e]={})},me=(e,t,n="app")=>{ye(n),globalThis.RudderStackGlobals[n][e]=t};const be=(e,t)=>{const n={};return e.forEach(((i,r)=>{if(r.startsWith(t)){const i=r.substring(t.length);n[i]=e.get(r)}})),n},Ee=e=>{const t=((e,t="app")=>(ye(t),globalThis.RudderStackGlobals[t][e]))(ge)||[];((e=[])=>{const t="ajs_trait_",n="ajs_prop_",i=new URLSearchParams(globalThis.location.search);i.get(ve)&&e.unshift(["track",i.get(ve),be(i,n)]),i.get(pe)&&e.unshift(["identify",i.get(pe),be(i,t)]),i.get(he)&&e.unshift(["setAnonymousId",i.get(he)])})(t),t.length>0&&(e.enqueuePreloadBufferEvents(t),me(ge,[]))},ke=(e,t)=>{const n=e.shift();let i;if(b(t[n])){switch(n){case"page":i=x(...e);break;case"track":i=j(...e);break;case"identify":i=H(...e);break;case"alias":i=_(...e);break;case"group":i=F(...e);break;default:t[n](...e)}i&&t[n](i)}},Se=":: ",Ie=(e,t)=>`Failed to load the script with the id "${e}" from URL "${t}".`,Te=(e,t,n)=>{const i=[];return function(r,s){if(!(t?.includes(r)||e&&I(s))){if("object"!=typeof s||k(s))return s;for(;i.length>0&&i[i.length-1]!==this;)i.pop();return i.includes(s)?(n?.warn(((e,t)=>`${e}${Se}A circular reference has been detected in the object and the property "${t}" has been dropped from the output.`)("JSONStringify",r)),"[Circular Reference]"):(i.push(s),s)}}},we=(e,t,n,i)=>{try{return JSON.stringify(e,Te(t,n,i))}catch(e){return i?.warn("Failed to convert the value to a JSON string.",e),null}},Ae=(e,t)=>{let n=e;return A(e)?n.message=`${t}: ${e.message}`:n=new Error(`${t}: ${we(e)}`),n},Pe=(e,t,n,i=!0,r)=>new Promise(((s,o)=>{document.getElementById(t)&&o(new Error((e=>`A script with the id "${e}" is already loaded. Skipping the loading of this script to prevent conflicts.`)(t)));try{let a;(e=>{const t=document.getElementsByTagName("head");if(t.length>0)return void t[0]?.insertBefore(e,t[0]?.firstChild);const n=document.getElementsByTagName("script");if(n.length>0&&n[0]?.parentNode)return void n[0]?.parentNode.insertBefore(e,n[0]);const i=document.createElement("head");i.appendChild(e);const r=document.getElementsByTagName("html")[0];r?.insertBefore(i,r.firstChild)})(((e,t,n=!0,i=null,r=null,s={})=>{const o=document.createElement("script");return o.type="text/javascript",o.onload=i,o.onerror=r,o.src=e,o.id=t,o.async=n,Object.keys(s).forEach((e=>{o.setAttribute(e,s[e])})),o.setAttribute("data-loader","RS_JS_SDK"),o})(e,t,i,(()=>{globalThis.clearTimeout(a),s(t)}),(()=>{globalThis.clearTimeout(a),o(new Error(Ie(t,e)))}),r)),a=globalThis.setTimeout((()=>{o(new Error(((e,t,n)=>`A timeout of ${n} ms occurred while trying to load the script with id "${e}" from URL "${t}".`)(t,e,n)))}),n)}catch(n){o(Ae(n,Ie(t,e)))}}));class Ce{hasErrorHandler=!1;constructor(e,t,n=1e4){this.errorHandler=e,this.logger=t,this.timeout=n,this.hasErrorHandler=Boolean(this.errorHandler),this.onError=this.onError.bind(this)}loadJSFile(e){const{url:t,id:n,timeout:i,async:r,callback:s,extraAttributes:o}=e,a=!b(s);Pe(t,n,i||this.timeout,r,o).then((e=>{a||s(e)})).catch((e=>{this.onError(e),a||s()}))}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,"ExternalSrcLoader")}}var De=Symbol.for("preact-signals");function $e(){if(Me>1)Me--;else{for(var e,t=!1;void 0!==Le;){var n=Le;for(Le=void 0,Be++;void 0!==n;){var i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&He(n))try{n.c()}catch(n){t||(e=n,t=!0)}n=i}}if(Be=0,Me--,t)throw e}}function Re(e){if(Me>0)return e();Me++;try{return e()}finally{$e()}}var Oe=void 0,Le=void 0,Me=0,Be=0,Ne=0;function Ue(e){if(void 0!==Oe){var t=e.n;if(void 0===t||t.t!==Oe)return t={i:0,S:e,p:Oe.s,n:void 0,t:Oe,e:void 0,x:void 0,r:t},void 0!==Oe.s&&(Oe.s.n=t),Oe.s=t,e.n=t,32&Oe.f&&e.S(t),t;if(-1===t.i)return t.i=0,void 0!==t.n&&(t.n.p=t.p,void 0!==t.p&&(t.p.n=t.n),t.p=Oe.s,t.n=void 0,Oe.s.n=t,Oe.s=t),t}}function xe(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}function je(e){return new xe(e)}function He(e){for(var t=e.s;void 0!==t;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function _e(e){for(var t=e.s;void 0!==t;t=t.n){var n=t.S.n;if(void 0!==n&&(t.r=n),t.S.n=t,t.i=-1,void 0===t.n){e.s=t;break}}}function Fe(e){for(var t=e.s,n=void 0;void 0!==t;){var i=t.p;-1===t.i?(t.S.U(t),void 0!==i&&(i.n=t.n),void 0!==t.n&&(t.n.p=i)):n=t,t.S.n=t.r,void 0!==t.r&&(t.r=void 0),t=i}e.s=n}function Qe(e){xe.call(this,void 0),this.x=e,this.s=void 0,this.g=Ne-1,this.f=4}function Ke(e){var t=e.u;if(e.u=void 0,"function"==typeof t){Me++;var n=Oe;Oe=void 0;try{t()}catch(t){throw e.f&=-2,e.f|=8,Ge(e),t}finally{Oe=n,$e()}}}function Ge(e){for(var t=e.s;void 0!==t;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Ke(e)}function ze(e){if(Oe!==this)throw new Error("Out-of-order effect");Fe(this),Oe=e,this.f&=-2,8&this.f&&Ge(this),$e()}function Ve(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function qe(e){var t=new Ve(e);try{t.c()}catch(e){throw t.d(),e}return t.d.bind(t)}xe.prototype.brand=De,xe.prototype.h=function(){return!0},xe.prototype.S=function(e){this.t!==e&&void 0===e.e&&(e.x=this.t,void 0!==this.t&&(this.t.e=e),this.t=e)},xe.prototype.U=function(e){if(void 0!==this.t){var t=e.e,n=e.x;void 0!==t&&(t.x=n,e.e=void 0),void 0!==n&&(n.e=t,e.x=void 0),e===this.t&&(this.t=n)}},xe.prototype.subscribe=function(e){var t=this;return qe((function(){var n=t.value,i=Oe;Oe=void 0;try{e(n)}finally{Oe=i}}))},xe.prototype.valueOf=function(){return this.value},xe.prototype.toString=function(){return this.value+""},xe.prototype.toJSON=function(){return this.value},xe.prototype.peek=function(){var e=Oe;Oe=void 0;try{return this.value}finally{Oe=e}},Object.defineProperty(xe.prototype,"value",{get:function(){var e=Ue(this);return void 0!==e&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(Be>100)throw new Error("Cycle detected");this.v=e,this.i++,Ne++,Me++;try{for(var t=this.t;void 0!==t;t=t.x)t.t.N()}finally{$e()}}}}),(Qe.prototype=new xe).h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f))return!0;if(this.f&=-5,this.g===Ne)return!0;if(this.g=Ne,this.f|=1,this.i>0&&!He(this))return this.f&=-2,!0;var e=Oe;try{_e(this),Oe=this;var t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return Oe=e,Fe(this),this.f&=-2,!0},Qe.prototype.S=function(e){if(void 0===this.t){this.f|=36;for(var t=this.s;void 0!==t;t=t.n)t.S.S(t)}xe.prototype.S.call(this,e)},Qe.prototype.U=function(e){if(void 0!==this.t&&(xe.prototype.U.call(this,e),void 0===this.t)){this.f&=-33;for(var t=this.s;void 0!==t;t=t.n)t.S.U(t)}},Qe.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;void 0!==e;e=e.x)e.t.N()}},Object.defineProperty(Qe.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=Ue(this);if(this.h(),void 0!==e&&(e.i=this.i),16&this.f)throw this.v;return this.v}}),Ve.prototype.c=function(){var e=this.S();try{if(8&this.f)return;if(void 0===this.x)return;var t=this.x();"function"==typeof t&&(this.u=t)}finally{e()}},Ve.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Ke(this),_e(this),Me++;var e=Oe;return Oe=this,ze.bind(this,e)},Ve.prototype.N=function(){2&this.f||(this.f|=2,this.o=Le,Le=this)},Ve.prototype.d=function(){this.f|=8,1&this.f||Ge(this)};class We{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){return 0===this.items.length?null:this.items.shift()}isEmpty(){return 0===this.items.length}size(){return this.items.length}clear(){this.items=[]}}const Je={LOG:0,INFO:1,DEBUG:2,WARN:3,ERROR:4,NONE:5};const Xe=new class{constructor(e="LOG",t="",n=console){this.minLogLevel=Je[e],this.scope=t,this.logProvider=n}log(...e){this.outputLog("LOG",e)}info(...e){this.outputLog("INFO",e)}debug(...e){this.outputLog("DEBUG",e)}warn(...e){this.outputLog("WARN",e)}error(...e){this.outputLog("ERROR",e)}outputLog(e,t){this.minLogLevel<=Je[e]&&this.logProvider[e.toLowerCase()]?.(...this.formatLogData(t))}setScope(e){this.scope=e||this.scope}setMinLogLevel(e){this.minLogLevel=Je[e],S(this.minLogLevel)&&(this.minLogLevel=Je.LOG)}formatLogData(e){if(Array.isArray(e)&&e.length>0){let t="%c RS SDK";this.scope&&(t=`${t} - ${this.scope}`);t=`${t} %c ${E(e[0])?e[0].trim():""}`;const n=[t,"font-weight: bold; background: black; color: white;","font-weight: normal;"];return E(e[0])||n.push(e[0]),n.push(...e.slice(1)),n}return e}};let Ze=function(e){return e.HANDLEDEXCEPTION="handledException",e.UNHANDLEDEXCEPTION="unhandledException",e.UNHANDLEDREJECTION="unhandledPromiseRejection",e}({});const Ye=["localStorage","memoryStorage","cookieStorage","sessionStorage","none"],et="cookieStorage",tt="Unable to process/parse source configuration response.",nt=e=>`${e}${Se}Failed to notify the error.`,it=(e,t,n)=>`${e} due to timeout or no connection (${t?t.type:""}) for URL: ${n}.`,rt="Failed to invoke the ready callback",st={All:!0},ot="js-integrations",at="plugins",lt=new RegExp("^(https?:\\/\\/)(((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|localhost|((25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$"),ut="modern",ct="https://cdn.rudderlabs.com",dt="v3",gt=`${ct}/${dt}/${ut}/${ot}`,ht=`${ct}/${dt}/${ut}/${at}`,pt="https://api.rudderstack.com",vt="v3",ft="xhr",yt={iubenda:"IubendaConsentManager",oneTrust:"OneTrustConsentManager",ketch:"KetchConsentManager",custom:"CustomConsentManager"},mt={[vt]:"StorageEncryption",legacy:"StorageEncryptionLegacy"},bt={[ft]:"XhrQueue",beacon:"BeaconQueue"},Et=je(g({logLevel:"ERROR",configUrl:pt,loadIntegration:!0,sessions:{autoTrack:!0,timeout:fe},sameSiteCookie:"Lax",polyfillIfRequired:!0,integrations:st,useBeacon:!1,beaconQueueOptions:{},destinationsQueueOptions:{},queueOptions:{},lockIntegrationsVersion:!1,lockPluginsVersion:!1,uaChTrackLevel:"none",plugins:[],useGlobalIntegrationsConfigInEvents:!1,bufferDataPlaneEventsUntilReady:!1,dataPlaneEventsBufferTimeout:1e4,storage:{encryption:{version:vt},migrate:!0,cookie:{}},sendAdblockPageOptions:{},useServerSideCookies:!1})),kt={userId:"",userTraits:{},anonymousId:"",groupId:"",groupTraits:{},initialReferrer:"",initialReferringDomain:"",sessionInfo:{},authToken:null},St={autoTrack:!0,timeout:fe},It={userId:je(kt.userId),userTraits:je(kt.userTraits),anonymousId:je(kt.anonymousId),groupId:je(kt.groupId),groupTraits:je(kt.groupTraits),initialReferrer:je(kt.initialReferrer),initialReferringDomain:je(kt.initialReferringDomain),sessionInfo:je(kt.sessionInfo),authToken:je(kt.authToken)},Tt={isOnline:je(!0),storage:{isLocalStorageAvailable:je(!1),isCookieStorageAvailable:je(!1),isSessionStorageAvailable:je(!1)},isBeaconAvailable:je(!1),isLegacyDOM:je(!1),isUaCHAvailable:je(!1),isCryptoAvailable:je(!1),isIE11:je(!1),isAdBlocked:je(!1)},wt={isErrorReportingEnabled:je(!1),isMetricsReportingEnabled:je(!1),isErrorReportingPluginLoaded:je(!1),breadcrumbs:je([])},At=je(void 0),Pt={activeDataplaneUrl:je(void 0),integrationsCDNPath:je(gt),pluginsCDNPath:je(ht),sourceConfigUrl:je(void 0),status:je(void 0),initialized:je(!1),logLevel:je("ERROR"),loaded:je(!1),readyCallbacks:je([]),writeKey:je(void 0),dataPlaneUrl:je(void 0)},Ct={enabled:je(!1),initialized:je(!1),data:je({}),activeConsentManagerPluginName:je(void 0),preConsent:je({enabled:!1}),postConsent:je({}),resolutionStrategy:je("and"),provider:je(void 0),metadata:je(void 0)},Dt={retries:je(0),dropped:je(0),sent:je(0),queued:je(0),triggered:je(0),metricsServiceUrl:je(void 0)},$t={app:je({name:ue,namespace:"com.rudderlabs.javascript",version:ce,installType:"cdn"}),traits:je(null),library:je({name:ue,version:ce,snippetVersion:globalThis.RudderSnippetVersion}),userAgent:je(""),device:je(null),network:je(null),os:je({name:"",version:""}),locale:je(null),screen:je({density:0,width:0,height:0,innerWidth:0,innerHeight:0}),"ua-ch":je(void 0),timezone:je(void 0)},Rt={configuredDestinations:je([]),activeDestinations:je([]),loadOnlyIntegrations:je({}),failedDestinations:je([]),loadIntegration:je(!0),initializedDestinations:je([]),clientDestinationsReady:je(!1),integrationsConfig:je({})},Ot={toBeProcessedArray:je([]),readyCallbacksArray:je([])},Lt={ready:je(!1),loadedPlugins:je([]),failedPlugins:je([]),pluginsToLoadFromConfig:je([]),activePlugins:je([]),totalPluginsToLoad:je(0)},Mt={encryptionPluginName:je(void 0),migrate:je(!1),type:je(void 0),cookie:je(void 0),entries:je({}),trulyAnonymousTracking:je(!1)},Bt={isEnabledServerSideCookies:je(!1),dataServiceUrl:je(void 0)},Nt={eventsQueuePluginName:je(void 0),deliveryEnabled:je(!0)},Ut={enabled:je(!1),pageLifecycle:{enabled:je(!1),visitId:je(void 0),pageLoadedTimestamp:je(void 0)}},xt={...g({capabilities:Tt,consents:Ct,context:$t,eventBuffer:Ot,lifecycle:Pt,loadOptions:Et,metrics:Dt,nativeDestinations:Rt,plugins:Lt,reporting:wt,session:It,source:At,storage:Mt,serverCookies:Bt,dataPlaneEvents:Nt,autoTrack:Ut})};const jt=new class{plugins=[];byName={};cache={};config={throws:!0};constructor(e={},t){this.config={throws:!0,...e},this.logger=t}register(e,t){if(!e.name){const t=`${J}${Se}Plugin name is missing.`;if(this.config.throws)throw new Error(t);this.logger?.error(t,e)}if(this.byName[e.name]){const t=((e,t)=>`${e}${Se}Plugin "${t}" already exists.`)(J,e.name);if(this.config.throws)throw new Error(t);this.logger?.error(t)}this.cache={},this.plugins=this.plugins.slice();let n=this.plugins.length;this.plugins.forEach(((t,i)=>{t.deps?.includes(e.name)&&(n=Math.min(n,i))})),this.plugins.splice(n,0,e),this.byName[e.name]=e,b(e.initialize)&&e.initialize(t)}unregister(e){const t=this.byName[e];if(!t){const t=`${J}${Se}Plugin "${e}" not found.`;if(this.config.throws)throw new Error(t);this.logger?.error(t)}const n=this.plugins.indexOf(t);if(-1===n){const t=((e,t)=>`${e}${Se}Plugin "${t}" not found in plugins but found in byName. This indicates a bug in the plugin engine. Please report this issue to the development team.`)(J,e);if(this.config.throws)throw new Error(t);this.logger?.error(t)}this.cache={},delete this.byName[e],this.plugins=this.plugins.slice(),this.plugins.splice(n,1)}getPlugin(e){return this.byName[e]}getPlugins(e){const t=e??".";return this.cache[t]||(this.cache[t]=this.plugins.filter((e=>{if(e.deps?.some((e=>!this.byName[e]))){const t=e.deps.filter((e=>!this.byName[e]));return this.logger?.error(((e,t,n)=>`${e}${Se}Plugin "${t}" could not be loaded because some of its dependencies "${n}" do not exist.`)(J,e.name,t)),!1}return"."===t||((e,t)=>Boolean(P(e,t)))(e,t)}))),this.cache[t]}processRawPlugins(e){e(this.plugins),this.cache={}}invoke(e,t=!0,...n){let i=e;if(!i)throw new Error("Failed to invoke plugin because the extension point name is missing.");const r=i.startsWith("!"),s=this.config.throws??i.endsWith("!");if(i=i.replace(/(^!|!$)/g,""),!i)throw new Error("Failed to invoke plugin because the extension point name is invalid.");const o=i.split(".");o.pop();const a=o.join(".");return(t?this.getPlugins(i):[this.getPlugins(i)[0]]).map((e=>{const t=P(e,i);if(!b(t)||r)return t;try{return t.apply(P(e,a),n)}catch(t){if(s)throw t;this.logger?.error(((e,t,n)=>`${e}${Se}Failed to invoke the "${t}" extension point of plugin "${n}".`)(J,i,e.name),t)}return null}))}invokeSingle(e,...t){return this.invoke(e,!1,...t)[0]}invokeMultiple(e,...t){return this.invoke(e,!0,...t)}}({throws:!0},Xe);const Ht=new class{constructor(e,t){this.logger=e,this.pluginEngine=t,this.errorBuffer=new We,this.attachEffect()}attachEffect(){if(!0===xt.reporting.isErrorReportingPluginLoaded.value)for(;this.errorBuffer.size()>0;){const e=this.errorBuffer.dequeue();e&&this.notifyError(e.error,e.errorState)}}attachErrorListeners(){"addEventListener"in globalThis?(globalThis.addEventListener("error",(e=>{this.onError(e,void 0,void 0,void 0,Ze.UNHANDLEDEXCEPTION)})),globalThis.addEventListener("unhandledrejection",(e=>{this.onError(e,void 0,void 0,void 0,Ze.UNHANDLEDREJECTION)}))):this.logger?.debug("Failed to attach global error listeners.")}init(e,t){if(this.httpClient=e,this.pluginEngine)try{const e="errorReporting.init",n=this.pluginEngine.invokeSingle(e,xt,this.pluginEngine,t,this.logger,!0);n instanceof Promise&&n.then((e=>{this.errReportingClient=e})).catch((e=>{this.logger?.error(`${W}${Se}Failed to initialize the error reporting plugin.`,e)}))}catch(e){this.onError(e,W)}}onError(e,t="",n="",i=!1,r=Ze.HANDLEDEXCEPTION){let s,o;if(r===Ze.HANDLEDEXCEPTION){if(o=(e=>{let t;try{t=E(e)?e:e instanceof Error||e instanceof ErrorEvent||e.message?e.message:we(e)}catch(e){t=`Unknown error: ${e.message}`}return t})(e),!o)return;o=`${t}${Se}${n} ${o}`.replace(/ {2,}/g," "),s=new Error(o),A(e)&&(s=Object.create(e,{message:{value:o}}))}else s=(e=>{try{if(e instanceof Error||e instanceof ErrorEvent||e instanceof PromiseRejectionEvent&&e.reason)return e;if(e instanceof Event){const t=e.target;if(t&&"script"!==t.localName)return;if(t?.dataset&&("RS_JS_SDK"!==t.dataset.loader||"true"!==t.dataset.isnonnativesdk))return;const n=`Error in loading a third-party script from URL ${t?.src} with ID ${t?.id}.`;return Object.create(e,{message:{value:n}})}return e}catch(e){return e}})(e);const a=xt.reporting.isErrorReportingEnabled.value,l=xt.reporting.isErrorReportingPluginLoaded.value;try{if(a){const e={severity:"error",unhandled:r!==Ze.HANDLEDEXCEPTION,severityReason:{type:r}};l?s&&this.notifyError(s,e):this.errorBuffer.enqueue({error:s,errorState:e})}}catch(e){this.logger?.error(nt(W),e)}if(r===Ze.HANDLEDEXCEPTION){if(!this.logger)throw s;if(this.logger.error(o),i)throw s}}leaveBreadcrumb(e){if(this.pluginEngine)try{this.pluginEngine.invokeSingle("errorReporting.breadcrumb",this.pluginEngine,this.errReportingClient,e,this.logger,xt)}catch(e){this.onError(e,W,"errorReporting.breadcrumb")}}notifyError(e,t){if(this.pluginEngine&&this.httpClient)try{this.pluginEngine.invokeSingle("errorReporting.notify",this.pluginEngine,this.errReportingClient,e,xt,this.logger,this.httpClient,t)}catch(e){this.logger?.error(nt(W),e)}}}(Xe,jt),_t=e=>Boolean("cloud"!==e.config.connectionMode||!0===e.config.useNativeSDKToSend||!0===e.config.useNativeSDK),Ft=e=>e.filter(_t),Qt=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","IubendaConsentManager","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],Kt={rudderAnalyticsRemotePlugins:{url:()=>Promise.resolve(window.RudderStackGlobals&&window.RudderStackGlobals.app&&window.RudderStackGlobals.app.pluginsCDNPath?`${window.RudderStackGlobals.app.pluginsCDNPath}/rsa-plugins.js`:"http://localhost:3002/cdn//rsa-plugins.js"),format:"esm",from:"vite"}},Gt=async(e,t)=>{const n="function"==typeof e?await e():e,i=document.createElement("script");i.type="text/javascript",i.onload=t,i.src=n,document.getElementsByTagName("head")[0].appendChild(i)};function zt(e,t){const n=Object.assign(e,t);for(const e of Object.keys(n))"object"==typeof n[e]&&"object"==typeof t[e]&&(n[e]=zt(n[e],t[e]));return n}const Vt=e=>zt({},(globalThis.__federation_shared__||{}).default||{});function qt(e,t){if(!e?.default&&t){let t=Object.create(null);return t.default=e,t.__esModule=!0,t}return e}function Wt(e,t){return async function(e){const t=Kt[e];return t.inited?t.lib:"var"===t.format?new Promise((n=>Gt(t.url,(()=>{t.inited||(t.lib=window[e],t.lib.init(Vt(t.from)),t.inited=!0),n(t.lib)})))):["esm","systemjs"].includes(t.format)?new Promise(((e,n)=>{("function"==typeof t.url?t.url:()=>Promise.resolve(t.url))().then((i=>{import(i).then((n=>{if(!t.inited){const e=Vt(t.from);n.init(e),t.lib=n,t.lib.init(e),t.inited=!0}e(t.lib)})).catch(n)}))})):void 0}(e).then((e=>e.get(t).then((e=>e()))))}const Jt=e=>{const t={};return e.forEach((e=>{if(Qt.includes(e)){const n=(e=>{switch(e){case"BeaconQueue":return()=>Wt("rudderAnalyticsRemotePlugins","./BeaconQueue").then((e=>qt(e,!0)));case"Bugsnag":return()=>Wt("rudderAnalyticsRemotePlugins","./Bugsnag").then((e=>qt(e,!0)));case"CustomConsentManager":return()=>Wt("rudderAnalyticsRemotePlugins","./CustomConsentManager").then((e=>qt(e,!0)));case"DeviceModeDestinations":return()=>Wt("rudderAnalyticsRemotePlugins","./DeviceModeDestinations").then((e=>qt(e,!0)));case"DeviceModeTransformation":return()=>Wt("rudderAnalyticsRemotePlugins","./DeviceModeTransformation").then((e=>qt(e,!0)));case"ErrorReporting":return()=>Wt("rudderAnalyticsRemotePlugins","./ErrorReporting").then((e=>qt(e,!0)));case"ExternalAnonymousId":return()=>Wt("rudderAnalyticsRemotePlugins","./ExternalAnonymousId").then((e=>qt(e,!0)));case"GoogleLinker":return()=>Wt("rudderAnalyticsRemotePlugins","./GoogleLinker").then((e=>qt(e,!0)));case"KetchConsentManager":return()=>Wt("rudderAnalyticsRemotePlugins","./KetchConsentManager").then((e=>qt(e,!0)));case"IubendaConsentManager":return()=>Wt("rudderAnalyticsRemotePlugins","./IubendaConsentManager").then((e=>qt(e,!0)));case"NativeDestinationQueue":return()=>Wt("rudderAnalyticsRemotePlugins","./NativeDestinationQueue").then((e=>qt(e,!0)));case"OneTrustConsentManager":return()=>Wt("rudderAnalyticsRemotePlugins","./OneTrustConsentManager").then((e=>qt(e,!0)));case"StorageEncryption":return()=>Wt("rudderAnalyticsRemotePlugins","./StorageEncryption").then((e=>qt(e,!0)));case"StorageEncryptionLegacy":return()=>Wt("rudderAnalyticsRemotePlugins","./StorageEncryptionLegacy").then((e=>qt(e,!0)));case"StorageMigrator":return()=>Wt("rudderAnalyticsRemotePlugins","./StorageMigrator").then((e=>qt(e,!0)));case"XhrQueue":return()=>Wt("rudderAnalyticsRemotePlugins","./XhrQueue").then((e=>qt(e,!0)));default:return}})(e);n&&(t[e]=n)}})),t},Xt=e=>Jt?.(e)||{},Zt={};class Yt{constructor(e,t,n){this.engine=e,this.errorHandler=t,this.logger=n,this.onError=this.onError.bind(this)}init(){xt.lifecycle.status.value="pluginsLoading",me("pluginsCDNPath",xt.lifecycle.pluginsCDNPath.value),this.setActivePlugins(),this.registerLocalPlugins(),this.registerRemotePlugins(),this.attachEffects()}attachEffects(){qe((()=>{(0===xt.plugins.activePlugins.value.length||xt.plugins.loadedPlugins.value.length+xt.plugins.failedPlugins.value.length===xt.plugins.totalPluginsToLoad.value)&&Re((()=>{xt.plugins.ready.value=!0,xt.lifecycle.status.value="pluginsReady"}))}))}getPluginsToLoadBasedOnConfig(){let e=xt.plugins.pluginsToLoadFromConfig.value;if(!e)return[];const t=[{configurationStatus:()=>T(xt.dataPlaneEvents.eventsQueuePluginName.value),configurationStatusStr:"Data plane events delivery is enabled",activePluginName:xt.dataPlaneEvents.eventsQueuePluginName.value,supportedPlugins:Object.values(bt),shouldAddMissingPlugins:!0},{configurationStatus:()=>xt.reporting.isErrorReportingEnabled.value,configurationStatusStr:"Error reporting is enabled",supportedPlugins:["ErrorReporting","Bugsnag"]},{configurationStatus:()=>Ft(xt.nativeDestinations.configuredDestinations.value).length>0,configurationStatusStr:"Device mode destinations are connected to the source",supportedPlugins:["DeviceModeDestinations","NativeDestinationQueue"]},{configurationStatus:()=>Ft(xt.nativeDestinations.configuredDestinations.value).some((e=>e.shouldApplyDeviceModeTransformation)),configurationStatusStr:"Device mode transformations are enabled for at least one destination",supportedPlugins:["DeviceModeTransformation"]},{configurationStatus:()=>T(xt.consents.activeConsentManagerPluginName.value),configurationStatusStr:"Consent management is enabled",activePluginName:xt.consents.activeConsentManagerPluginName.value,supportedPlugins:Object.values(yt)},{configurationStatus:()=>T(xt.storage.encryptionPluginName.value),configurationStatusStr:"Storage encryption is enabled",activePluginName:xt.storage.encryptionPluginName.value,supportedPlugins:Object.values(mt)},{configurationStatus:()=>xt.storage.migrate.value,configurationStatusStr:"Storage migration is enabled",supportedPlugins:["StorageMigrator"]}];return t.forEach((t=>{t.configurationStatus()?(e=e.filter(t.activePluginName?e=>!(e!==t.activePluginName&&t.supportedPlugins.includes(e)):e=>T(e)),this.addMissingPlugins(t,false,e)):e=e.filter(void 0!==t.basePlugins?e=>!(t.basePlugins.includes(e)||t.supportedPlugins.includes(e)):e=>!t.supportedPlugins.includes(e))})),[...Object.keys({}),...e]}addMissingPlugins(e,t,n){const i=e.shouldAddMissingPlugins||t;let r;r=e.activePluginName?[...e.basePlugins||[],e.activePluginName]:[...e.supportedPlugins];const s=r.filter((e=>!n.includes(e)));s.length>0&&(i&&n.push(...s),this.logger?.warn(((e,t,n,i)=>{const r=1===n.length,s=r?` '${n[0]}' plugin was`:` ['${n.join("', '")}'] plugins were`,o=`${e}${Se}${t}, but${s} not configured to load.`;return i?`${o} So, ${r?"the plugin":"those plugins"} will be loaded automatically.`:`${o} Ignore if this was intentional. Otherwise, consider adding ${r?"it":"them"} to the 'plugins' load API option.`})(V,e.configurationStatusStr,s,i)))}setActivePlugins(){const e=this.getPluginsToLoadBasedOnConfig(),t=[...Object.keys(Zt),...Qt],n=[],i=[];e.forEach((e=>{t.includes(e)?n.push(e):i.push(e)})),i.length>0&&this.onError(new Error(`Ignoring loading of unknown plugins: ${i.join(",")}. Mandatory plugins: ${Object.keys({}).join(",")}. Load option plugins: ${xt.plugins.pluginsToLoadFromConfig.value.join(",")}`)),Re((()=>{xt.plugins.totalPluginsToLoad.value=e.length,xt.plugins.activePlugins.value=n,xt.plugins.failedPlugins.value=i}))}registerLocalPlugins(){Object.values(Zt).forEach((e=>{b(e)&&xt.plugins.activePlugins.value.includes(e().name)&&this.register([e()])}))}registerRemotePlugins(){const e=(t=xt.plugins.activePlugins.value,{...Xt(t)});var t;Promise.all(Object.keys(e).map((async t=>{await e[t]().then((e=>this.register([e.default()]))).catch((e=>{xt.plugins.failedPlugins.value=[...xt.plugins.failedPlugins.value,t],this.onError(e,t)}))}))).catch((e=>{this.onError(e)}))}invokeMultiple(e,...t){try{return this.engine.invokeMultiple(e,...t)}catch(t){return this.onError(t,e),[]}}invokeSingle(e,...t){try{return this.engine.invokeSingle(e,...t)}catch(t){return this.onError(t,e),null}}register(e){e.forEach((e=>{try{this.engine.register(e,xt)}catch(t){xt.plugins.failedPlugins.value=[...xt.plugins.failedPlugins.value,e.name],this.onError(t)}}))}unregisterLocalPlugins(){Object.values(Zt).forEach((e=>{try{this.engine.unregister(e().name)}catch(e){this.onError(e)}}))}onError(e,t){if(!this.errorHandler)throw e;this.errorHandler.onError(e,V,t)}}const en=(e,t)=>{try{return JSON.parse(e||"")}catch(e){const n=Ae(e,"Failed to parse response data");if(!b(t))throw n;t(n)}},tn="The request failed",nn={headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},method:"GET"},rn=(e,t,n)=>{const i=R(nn,t||{});return n&&(i.headers=R(i.headers,{Authorization:n})),i.url=e,i},sn=(e,t=1e4,n)=>new Promise(((i,r)=>{let s;if(!0===e.sendRawData)s=e.data;else if(s=we(e.data,!1,[],n),k(s))return void r({error:new Error("Failed to prepare data for the request."),undefined:void 0,options:e});const o=new XMLHttpRequest,a=t=>{r({error:new Error(it(tn,t,e.url)),xhr:o,options:e})};o.ontimeout=a,o.onerror=a,o.onload=()=>{var t,n,s,a;o.status>=200&&o.status<400?i({response:o.responseText,xhr:o,options:e}):r({error:new Error((t=tn,n=o.status,s=o.statusText,a=e.url,`${t} with status: ${n}, ${s} for URL: ${a}.`)),xhr:o,options:e})},o.open(e.method,e.url,!0),!0===e.withCredentials&&(o.withCredentials=!0),o.timeout=t,Object.keys(e.headers).forEach((t=>{e.headers[t]&&o.setRequestHeader(t,e.headers[t])}));try{o.send(s)}catch(t){r({error:Ae(t,(l=tn,u=e.url,`${l} for URL: ${u}`)),xhr:o,options:e})}var l,u}));class on{hasErrorHandler=!1;constructor(e,t){this.errorHandler=e,this.logger=t,this.hasErrorHandler=Boolean(this.errorHandler),this.onError=this.onError.bind(this)}async getData(e){const{url:t,options:n,timeout:i,isRawResponse:r}=e;try{const e=await sn(rn(t,n,this.basicAuthHeader),i,this.logger);return{data:r?e.response:en(e.response,this.onError),details:e}}catch(e){return this.onError(e.error??e),{data:void 0,details:e}}}getAsyncData(e){const{callback:t,url:n,options:i,timeout:r,isRawResponse:s}=e,o=!b(t);sn(rn(n,i,this.basicAuthHeader),r,this.logger).then((e=>{o||t(s?e.response:en(e.response,this.onError),e)})).catch((e=>{this.onError(e.error??e),o||t(void 0,e)}))}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,"HttpClient")}setAuthHeader(e,t=!1){const n=t?e:U(`${e}:`);this.basicAuthHeader=`Basic ${n}`}resetAuthHeader(){this.basicAuthHeader=void 0}}const an=new on(Ht,Xe),ln="cookieStorage",un="localStorage",cn="sessionStorage",dn="memoryStorage",gn="none",hn={userId:"rl_user_id",userTraits:"rl_trait",anonymousId:"rl_anonymous_id",groupId:"rl_group_id",groupTraits:"rl_group_trait",initialReferrer:"rl_page_init_referrer",initialReferringDomain:"rl_page_init_referring_domain",sessionInfo:"rl_session",authToken:"rl_auth_token"},pn="clientDataInCookie",vn="clientDataInLocalStorage",fn="clientDataInSessionStorage",yn=["userId","userTraits","anonymousId","groupId","groupTraits","initialReferrer","initialReferringDomain","sessionInfo","authToken"],mn={[ln]:pn,[un]:vn,[dn]:"clientDataInMemory",[cn]:fn},bn=(e,t)=>{try{return encodeURIComponent(e)}catch(e){return void t?.error("Failed to encode the cookie data.",e)}},En=e=>{try{return decodeURIComponent(e)}catch(e){return}},kn=()=>(e=>{const t={},n=e.split(/\s*;\s*/);let i;return n[0]?(n.forEach((e=>{i=e.split("=");const n=i[0]?En(i[0]):void 0;n&&(t[n]=i[1]?En(i[1]):void 0)})),t):t})(globalThis.document.cookie),Sn=function(e,t,n,i){switch(arguments.length){case 4:case 3:case 2:return((e,t,n,i)=>{const r={...n||{}};let s=`${bn(e,i)}=${bn(t,i)}`;k(t)&&(r.maxage=-1),r.maxage&&(r.expires=new Date(+new Date+r.maxage)),r.path&&(s+=`; path=${r.path}`),r.domain&&(s+=`; domain=${r.domain}`),r.expires&&(s+=`; expires=${r.expires.toUTCString()}`),r.samesite&&(s+=`; samesite=${r.samesite}`),r.secure&&(s+="; secure"),globalThis.document.cookie=s})(e,t,n,i);case 1:return e?(e=>kn()[e])(e):kn();default:return kn()}},In=()=>!I(globalThis.navigator.userAgentData),Tn={URL:()=>!b(globalThis.URL)||!b(globalThis.URLSearchParams),Promise:()=>!b(globalThis.Promise),"Number.isNaN":()=>!b(globalThis.Number.isNaN),"Number.isInteger":()=>!b(globalThis.Number.isInteger),"Array.from":()=>!b(globalThis.Array.from),"Array.prototype.find":()=>!b(globalThis.Array.prototype.find),"Array.prototype.includes":()=>!b(globalThis.Array.prototype.includes),"String.prototype.endsWith":()=>!b(globalThis.String.prototype.endsWith),"String.prototype.startsWith":()=>!b(globalThis.String.prototype.startsWith),"String.prototype.includes":()=>!b(globalThis.String.prototype.includes),"String.prototype.replaceAll":()=>!b(globalThis.String.prototype.replaceAll),"String.fromCodePoint":()=>!b(globalThis.String.fromCodePoint),"Object.entries":()=>!b(globalThis.Object.entries),"Object.values":()=>!b(globalThis.Object.values),"Object.assign":()=>!b(globalThis.Object.assign),"Object.fromEntries":()=>!b(globalThis.Object.fromEntries),"Element.prototype.dataset":()=>!(()=>{const e=globalThis.document.createElement("div");return e.setAttribute("data-a-b","c"),!!e.dataset&&"c"===e.dataset.aB})(),TextEncoder:()=>!b(globalThis.TextEncoder)||!b(globalThis.TextDecoder),requestAnimationFrame:()=>!b(globalThis.requestAnimationFrame)||!b(globalThis.cancelAnimationFrame),CustomEvent:()=>!b(globalThis.CustomEvent),"navigator.sendBeacon":()=>!b(globalThis.navigator.sendBeacon),ArrayBuffer:()=>!b(globalThis.Uint8Array),Set:()=>!b(globalThis.Set),atob:()=>!b(globalThis.atob)},wn=()=>{let e={density:0,width:0,height:0,innerWidth:0,innerHeight:0};return e={width:globalThis.screen.width,height:globalThis.screen.height,density:globalThis.devicePixelRatio,innerWidth:globalThis.innerWidth,innerHeight:globalThis.innerHeight},e},An=e=>{const t=["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"].includes(e.name)||[22,1014].includes(e.code);return e instanceof DOMException&&t},Pn=(e=un,t,n)=>{let i,r;const s=`${K}${Se}The "${e}" storage type is `;let o,a="unavailable",l=!0;try{switch(e){case dn:return!0;case ln:i=t,r="test_rudder_cookie";break;case un:i=t??globalThis.localStorage,r="test_rudder_ls";break;case cn:i=t??globalThis.sessionStorage,r="test_rudder_ss";break;default:return!1}if(i&&(i.setItem(r,"true"),i.getItem(r)))return i.removeItem(r),!0;l=!1}catch(e){l=!1,o=e,An(e)&&(a="full")}return l||n?.warn(`${s}${a}.`,o),!1},Cn=e=>{const t="function"!=typeof globalThis.URL?(e=>{const t=document.createElement("a");return t.href=e,t.hostname})(e):new URL(e).hostname,n=t?.split(".")??[],i=n[n.length-1],r=[];if(4===n.length&&i&&i===parseInt(i,10).toString())return r;if(n.length<=1)return n[0]&&-1!==n[0].indexOf("localhost")?["localhost"]:r;for(let e=n.length-2;e>=0;e-=1)r.push(n.slice(e).join("."));return r},Dn=()=>{const e=`.${(e=>{const t=Cn(e);for(let e=0;e<t.length;e+=1){const n=t[e],i="__tld__",r={domain:`${-1!==n.indexOf("localhost")?"":"."}${n}`};if(Sn(i,1,r),Sn(i))return Sn(i,null,r),n}return""})(globalThis.location.href)}`;return{maxage:31536e6,path:"/",domain:e&&"."!==e?e:void 0,samesite:"Lax",enabled:!0}};class $n{static globalSingleton=null;isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e={},t){if($n.globalSingleton)return $n.globalSingleton;this.options=Dn(),this.logger=t,this.configure(e),$n.globalSingleton=this}configure(e){return this.options=R(this.options??{},e),e.sameDomainCookiesOnly&&delete this.options.domain,this.isSupportAvailable=Pn(ln,this),this.isEnabled=Boolean(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){return Sn(e,t,this.options,this.logger),this.length=Object.keys(Sn()).length,!0}getItem(e){const t=Sn(e);return S(t)?null:t}removeItem(e){const t=this.setItem(e,null);return this.length=Object.keys(Sn()).length,t}clear(){}key(e){return this.keys()[e]??null}keys(){return Object.keys(Sn())}}const Rn=new class{isEnabled=!0;length=0;data={};constructor(e,t){this.options={enabled:!0},this.logger=t,this.configure(e??{})}configure(e){return this.options=R(this.options,e),this.isEnabled=Boolean(this.options.enabled),this.options}setItem(e,t){return this.data[e]=t,this.length=Object.keys(this.data).length,t}getItem(e){return e in this.data?this.data[e]:null}removeItem(e){return e in this.data&&delete this.data[e],this.length=Object.keys(this.data).length,null}clear(){this.data={},this.length=0}key(e){return this.keys()[e]??null}keys(){return Object.keys(this.data)}}({},Xe);function On(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ln,Mn={exports:{}};var Bn=(Ln||(Ln=1,Mn.exports=function(){function e(e){return e=JSON.stringify(e),!!/^\{[\s\S]*\}$/.test(e)}function t(e){return void 0===e||"function"==typeof e?e+"":JSON.stringify(e)}function n(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}}function i(e){return"[object Function]"==={}.toString.call(e)}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e){var t="_Is_Incognit",n="yes";try{e||(e=window.localStorage),e.setItem(t,n),e.removeItem(t)}catch(t){var i={_data:{},setItem:function(e,t){return i._data[e]=String(t)},getItem:function(e){return i._data.hasOwnProperty(e)?i._data[e]:void 0},removeItem:function(e){return delete i._data[e]},clear:function(){return i._data={}}};e=i}finally{e.getItem(t)===n&&e.removeItem(t)}return e}var o=s();function a(){if(!(this instanceof a))return new a}a.prototype={set:function(n,i){if(n&&!e(n))o.setItem(n,t(i));else if(e(n))for(var r in n)this.set(r,n[r]);return this},get:function(e){if(void 0===e){var t={};return this.forEach((function(e,n){return t[e]=n})),t}if("?"===e.charAt(0))return this.has(e.substr(1));var i=arguments;if(i.length>1){for(var r={},s=0,a=i.length;s<a;s++){var l=n(o.getItem(i[s]));this.has(i[s])&&(r[i[s]]=l)}return r}return n(o.getItem(e))},clear:function(){return o.clear(),this},remove:function(e){var t=this.get(e);return o.removeItem(e),t},has:function(e){return{}.hasOwnProperty.call(this.get(),e)},keys:function(){var e=[];return this.forEach((function(t){e.push(t)})),e},forEach:function(e){for(var t=0,n=o.length;t<n;t++){var i=o.key(t);e(i,this.get(i))}return this},search:function(e){for(var t=this.keys(),n={},i=0,r=t.length;i<r;i++)t[i].indexOf(e)>-1&&(n[t[i]]=this.get(t[i]));return n},len:function(){return o.length}};var l=null;function u(t,n){var s=arguments,o=null;if(l||(l=a()),0===s.length)return l.get();if(1===s.length){if("string"==typeof t)return l.get(t);if(e(t))return l.set(t)}if(2===s.length&&"string"==typeof t){if(!n)return l.remove(t);if(n&&"string"==typeof n)return l.set(t,n);n&&i(n)&&(o=null,o=n(t,l.get(t)),u.set(t,o))}if(2===s.length&&r(t)&&i(n))for(var c=0,d=t.length;c<d;c++)o=n(t[c],l.get(t[c])),u.set(t[c],o);return u}for(var c in a.prototype)u[c]=a.prototype[c];return u}()),Mn.exports);const Nn=On(Bn);const Un=new class{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e={},t){this.options={enabled:!0},this.logger=t,this.configure(e)}configure(e){return this.options=R(this.options,e),this.isSupportAvailable=Pn(un),this.isEnabled=Boolean(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){Nn.set(e,t),this.length=Nn.len()}getItem(e){const t=Nn.get(e);return S(t)?null:t}removeItem(e){Nn.remove(e),this.length=Nn.len()}clear(){Nn.clear(),this.length=0}key(e){return this.keys()[e]??null}keys(){return Nn.keys()}}({},Xe);const xn=new class{isSupportAvailable=!0;isEnabled=!0;length=0;constructor(e={},t){this.options={enabled:!0},this.logger=t,this.configure(e)}configure(e){return this.options=R(this.options,e),this.isSupportAvailable=Pn(cn),this.isSupportAvailable&&(this.store=globalThis.sessionStorage),this.isEnabled=Boolean(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){this.store&&(this.store.setItem(e,t),this.length=this.store.length)}getItem(e){if(!this.store)return null;const t=this.store.getItem(e);return S(t)?null:t}removeItem(e){this.store&&(this.store.removeItem(e),this.length=this.store.length)}clear(){this.store?.clear(),this.length=0}key(e){return this.store?.key(e)??null}keys(){const e=[];if(!this.store)return e;for(let t=0;t<this.store.length;t+=1){const n=this.store.key(t);null!==n&&e.push(n)}return e}}({},Xe),jn=e=>{switch(e){case un:return Un;case cn:return xn;case dn:return Rn;case ln:return new $n({},Xe);default:return Rn}},Hn=(e={},t={},n={},i={})=>{var r;(e=>{const t=new $n({},Xe).configure(e);xt.storage.cookie.value={maxage:t.maxage,path:t.path,domain:t.domain,samesite:t.samesite,expires:t.expires,secure:t.secure}})(e),r=t,Un.configure(r),(e=>{Rn.configure(e)})(n),(e=>{xn.configure(e)})(i)};class _n{hasErrorHandler=!1;constructor(e,t,n){this.id=e.id,this.name=e.name,this.isEncrypted=e.isEncrypted??!1,this.validKeys=e.validKeys??{},this.engine=t??jn(un),this.noKeyValidation=0===Object.keys(this.validKeys).length,this.noCompoundKey=e.noCompoundKey,this.originalEngine=this.engine,this.errorHandler=e.errorHandler??Ht,this.hasErrorHandler=Boolean(this.errorHandler),this.logger=e.logger??Xe,this.pluginsManager=n}createValidKey(e){const{name:t,id:n,validKeys:i,noKeyValidation:r,noCompoundKey:s}=this;if(r)return s?e:[t,n,e].join(".");let o;return Object.values(i).forEach((i=>{i===e&&(o=s?e:[t,n,e].join("."))})),o}swapQueueStoreToInMemoryEngine(){const{name:e,id:t,validKeys:n,noCompoundKey:i}=this,r=jn(dn);Object.keys(n).forEach((s=>{const o=this.get(n[s]),a=i?s:[e,t,s].join(".");r.setItem(a,o),this.remove(s)})),this.engine=r}set(e,t){const n=this.createValidKey(e);if(n)try{this.engine.setItem(n,this.encrypt(we(t,!1,[],this.logger)))}catch(n){An(n)?(this.logger?.warn(`${`Store ${this.id}`}${Se}The storage is either full or unavailable, so the data will not be persisted. Switching to in-memory storage.`),this.swapQueueStoreToInMemoryEngine(),this.set(e,t)):this.onError(Ae(n,(e=>`Failed to save the value for "${e}" to storage`)(e)))}}get(e){const t=this.createValidKey(e);let n;try{return t?(n=this.decrypt(this.engine.getItem(t)),I(n)?null:JSON.parse(n)):null}catch(t){return this.onError(new Error(`${(e=>`Failed to retrieve or parse data for "${e}" from storage`)(e)}: ${t.message}`)),E(n)&&n.startsWith("RudderEncrypt:")&&this.logger?.warn((e=>`The cookie data for ${e} seems to be encrypted using SDK versions < v3. The data is dropped. This can potentially stem from using SDK versions < v3 on other sites or web pages that can share cookies with this webpage. We recommend using the same SDK (v3) version everywhere or avoid disabling the storage data migration.`)(e)),null}}remove(e){const t=this.createValidKey(e);t&&this.engine.removeItem(t)}getOriginalEngine(){return this.originalEngine}decrypt(e){return I(e)?null:this.crypto(e,"decrypt")}encrypt(e){return this.crypto(e,"encrypt")}crypto(e,t){const n=!this.isEncrypted||!e||"string"!=typeof e||""===(e=>e.replace(/^\s+|\s+$/gm,""))(e);if(n)return e;const i=`storage.${t}`,r=this.pluginsManager?this.pluginsManager.invokeSingle(i,e):e;return void 0===r?e:r??""}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,`Store ${this.id}`)}}class Fn{stores={};isInitialized=!1;hasErrorHandler=!1;constructor(e,t,n){this.errorHandler=t,this.logger=n,this.hasErrorHandler=Boolean(this.errorHandler),this.pluginsManager=e,this.onError=this.onError.bind(this)}init(){if(this.isInitialized)return;const e=xt.loadOptions.value,t={cookieStorageOptions:{samesite:e.sameSiteCookie,secure:e.secureCookie,domain:e.setCookieDomain,sameDomainCookiesOnly:e.sameDomainCookiesOnly,enabled:!0},localStorageOptions:{enabled:!0},inMemoryStorageOptions:{enabled:!0},sessionStorageOptions:{enabled:!0}};Hn(L(R(t.cookieStorageOptions??{},xt.storage.cookie?.value??{})),L(t.localStorageOptions),L(t.inMemoryStorageOptions),L(t.sessionStorageOptions)),this.initClientDataStores(),this.isInitialized=!0}initClientDataStores(){this.initializeStorageState();[dn,un,ln,cn].forEach((e=>{jn(e)?.isEnabled&&this.setStore({id:mn[e],name:mn[e],isEncrypted:!0,noCompoundKey:!0,type:e})}))}initializeStorageState(){let e=xt.storage.type.value,t=xt.loadOptions.value.storage?.entries;const n=xt.consents.postConsent.value.storage;(T(n?.type)||T(n?.entries))&&(e=n?.type,t=n?.entries);let i=!0,r={};yn.forEach((n=>{const s=n,o=n,a=t?.[s]?.type,l=((e,t)=>{let n;if(e.consents.preConsent.value.enabled)switch(e.consents.preConsent.value.storage?.strategy){case"none":n=gn;break;case"session":"sessionInfo"!==t&&(n=gn);break;case"anonymousId":"anonymousId"!==t&&(n=gn)}return n})(xt,n),u=l??a??e??et,c=this.getResolvedStorageTypeForEntry(u,n);c!==gn&&(i=!1),r={...r,[n]:{type:c,key:hn[o]}}})),Re((()=>{xt.storage.type.value=e,xt.storage.entries.value=r,xt.storage.trulyAnonymousTracking.value=i}))}getResolvedStorageTypeForEntry(e,t){let n=e;switch(e){case un:jn(un)?.isEnabled||(n=dn);break;case cn:jn(cn)?.isEnabled||(n=dn);break;case dn:case gn:break;default:n=jn(ln)?.isEnabled?ln:jn(un)?.isEnabled?un:jn(cn)?.isEnabled?cn:dn}return n!==e&&this.logger?.warn(((e,t,n,i)=>`${e}${Se}The storage type "${n}" is not available for entry "${t}". The SDK will initialize the entry with "${i}" storage type instead.`)(X,t,e,n)),n}setStore(e){const t=jn(e.type);return this.stores[e.id]=new _n(e,t,this.pluginsManager),this.stores[e.id]}getStore(e){return this.stores[e]}onError(e){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,X)}}const Qn=e=>{if(!E(e))return!1;try{return b(globalThis.URL)&&new URL(e),lt.test(e)}catch(e){return!1}},Kn=(e,t)=>{(e=>{if(!E(e)||0===e.trim().length)throw new Error((e=>`The write key "${e}" is invalid. It must be a non-empty string. Please check that the write key is correct and try again.`)(e))})(e),(e=>{if(!Qn(e))throw new Error((e=>`The data plane URL "${e}" is invalid. It must be a valid URL string. Please check that the data plane URL is correct and try again.`)(e))})(t)},Gn=e=>{const t=new URL(e),{host:n,protocol:i}=t,r=n.split(".");let s;return s=r.length>2?`${r[r.length-2]}.${r[r.length-1]}`:n,{topDomain:s,protocol:i}},zn=(e,t)=>`${t?window.location.origin:(e=>{const{topDomain:t,protocol:n}=Gn(e);return`${n}//${t}`})(window.location.href)}/${e.startsWith("/")?e.substring(1):e}`,Vn=e=>e?.endsWith("/")?Vn(e.substring(0,e.length-1)):e,qn=e=>{try{return new URL(e).host}catch(e){return null}},Wn=e=>qn(e)??"",Jn=e=>{const t={};try{const n=new URL(e),i="utm_";n.searchParams.forEach(((e,n)=>{if(n.startsWith(i)){let r=n.substring(i.length);"campaign"===r&&(r="name"),t[r]=e}}))}catch(e){}return t},Xn="none",Zn="immediate",Yn=e=>O(e)||Array.isArray(e),ei=(e,t)=>{let{provider:n}=e;const i=n?yt[n]:void 0;var r;return n&&!i&&(t?.error((r=yt,`${G}${Se}The consent manager "${n}" is not supported. Please choose one of the following supported consent managers: "${Object.keys(r)}".`)),n=void 0),{provider:n,consentManagerPluginName:i}},ti=(e,t)=>{let n,i,r=[],s=[],o=!1,a=!0===e?.enabled;O(e)&&a&&(({provider:i,consentManagerPluginName:n}=ei(e,t)),Yn(e.allowedConsentIds)&&(r=e.allowedConsentIds,o=!0),Yn(e.deniedConsentIds)&&(s=e.deniedConsentIds,o=!0));const l={allowedConsentIds:r,deniedConsentIds:s};return a=a&&Boolean(n),{provider:i,consentManagerPluginName:n,initialized:o,enabled:a,consentsData:l}},ni=e=>{var t;xt.reporting.isErrorReportingEnabled.value=!(t=e.source.config,!0!==t?.statsCollection?.errors?.enabled||window.chrome&&window.chrome.runtime&&window.chrome.runtime.id),xt.reporting.isMetricsReportingEnabled.value=(e=>!0===e?.statsCollection?.metrics?.enabled)(e.source.config)},ii=e=>{const{useServerSideCookies:t,dataServiceEndpoint:n,storage:i,setCookieDomain:r,sameDomainCookiesOnly:s}=xt.loadOptions.value;let o,a=i?.cookie,l=!1;if(t){l=t;const i=a.domain??r,u=T(i)&&!(e=>{const{topDomain:t}=Gn(window.location.href);return t===e})(B(i))||s,c=zn(n??"rsaRequest",u);if(Qn(c)){o=Vn(c);const t=qn(window.location.href),n=qn(c);t!==n&&(a={...a,samesite:"None",secure:!0}),!s&&u&&n!==B(i)&&(l=!1,e?.warn(((e,t,n)=>`${e}${Se}The provided cookie domain (${t}) does not match the current webpage's domain (${n}). Hence, the cookies will be set client-side.`)(G,i,n)))}else l=!1}return{sscEnabled:l,cookieOptions:a,finalDataServiceUrl:o}},ri=e=>{const{storage:t}=xt.loadOptions.value;let n=t?.type;T(n)&&!(e=>"string"==typeof e&&Ye.includes(e))(n)&&(e?.warn(((e,t,n)=>`${e}${Se}The storage type "${t}" is not supported. Please choose one of the following supported types: "${Ye}". The default type "${n}" will be used instead.`)(G,n,et)),n=et);let i=t?.encryption?.version;const r=i&&mt[i];var s,o;!S(i)&&S(r)?(e?.warn((s=mt,o=vt,`${G}${Se}The storage encryption version "${i}" is not supported. Please choose one of the following supported versions: "${Object.keys(s)}". The default version "${o}" will be used instead.`)),i=vt):S(i)&&(i=vt);const a=t?.migrate,l=a&&i===vt;!0===a&&l!==a&&e?.warn(((e,t,n)=>`${e}${Se}The storage data migration has been disabled because the configured storage encryption version (${t}) is not the latest (${n}). To enable storage data migration, please update the storage encryption version to the latest version.`)(G,i,vt));const{sscEnabled:u,finalDataServiceUrl:c,cookieOptions:d}=ii(e);Re((()=>{xt.storage.type.value=n,xt.storage.cookie.value=d,xt.serverCookies.isEnabledServerSideCookies.value=u,xt.serverCookies.dataServiceUrl.value=c,xt.storage.encryptionPluginName.value=mt[i],xt.storage.migrate.value=l}))},si=e=>{const{provider:t,consentManagerPluginName:n,initialized:i,enabled:r,consentsData:s}=ti(xt.loadOptions.value.consentManagement,e),o=xt.loadOptions.value.preConsent;let a=o?.storage?.strategy??Xn;var l,u;T(a)&&!["none","session","anonymousId"].includes(a)&&(a=Xn,e?.warn((l=G,u=o?.storage?.strategy,`${l}${Se}The pre-consent storage strategy "${u}" is not supported. Please choose one of the following supported strategies: "none, session, anonymousId". The default strategy "${Xn}" will be used instead.`)));let c=o?.events?.delivery??Zn;T(c)&&!["immediate","buffer"].includes(c)&&(c=Zn,e?.warn(((e,t,n)=>`${e}${Se}The pre-consent events delivery type "${t}" is not supported. Please choose one of the following supported types: "immediate, buffer". The default type "${n}" will be used instead.`)(G,o?.events?.delivery,Zn))),Re((()=>{xt.consents.activeConsentManagerPluginName.value=n,xt.consents.initialized.value=i,xt.consents.enabled.value=r,xt.consents.data.value=s,xt.consents.provider.value=t,xt.consents.preConsent.value={enabled:!0===xt.loadOptions.value.preConsent?.enabled&&!1===i&&!0===r,storage:{strategy:a},events:{delivery:c}}}))},oi=e=>{if(xt.dataPlaneEvents.deliveryEnabled.value){const t="XhrQueue";let n=t;xt.loadOptions.value.useBeacon&&(xt.capabilities.isBeaconAvailable.value?n="BeaconQueue":(n=t,e?.warn(`${G}${Se}The Beacon API is not supported by your browser. The events will be sent using XHR instead.`))),Re((()=>{xt.dataPlaneEvents.eventsQueuePluginName.value=n}))}},ai=(e,t,n,i,r)=>{const s=new URLSearchParams({p:"cdn",v:ce,build:ut,writeKey:t,lockIntegrationsVersion:n.toString(),lockPluginsVersion:i.toString()});let o=pt,a=s,l="/sourceConfig/",u="";if(Qn(e)){const t=new URL(e);Vn(t.pathname).endsWith("/sourceConfig")||(t.pathname=`${Vn(t.pathname)}/sourceConfig/`),t.pathname=t.pathname.replace(/\/{2,}/g,"/"),s.forEach(((e,n)=>{null===t.searchParams.get(n)&&t.searchParams.set(n,e)})),o=t.origin,l=t.pathname,a=t.searchParams,u=t.hash}else r?.warn(((e,t)=>`${e}${Se}The provided source config URL "${t}" is invalid. Using the default source config URL instead.`)(G,e));return`${o}${l}?${a}${u}`},li=(e,t,n,i,r,s)=>{let o="";if(s){if(!Qn(s))throw new Error(`Failed to load the SDK as the base URL for ${e} is not valid.`);return Vn(s)}const a=(()=>{const e=document.getElementsByTagName("script"),t=/(?:^|\/)rsa(\.min)?\.js$/;for(const n of e){const e=n.getAttribute("src");if(e&&t.test(e))return e}})();return o=a?a.split("/").slice(0,-1).concat(t).join("/"):n,r&&(o=o.replace(`/${dt}/${ut}/${t}`,`/${i}/${ut}/${t}`)),o};class ui{hasErrorHandler=!1;constructor(e,t,n){this.errorHandler=t,this.logger=n,this.httpClient=e,this.hasErrorHandler=Boolean(this.errorHandler),this.onError=this.onError.bind(this),this.processConfig=this.processConfig.bind(this)}attachEffects(){qe((()=>{this.logger?.setMinLogLevel(xt.lifecycle.logLevel.value)}))}init(){this.attachEffects(),Kn(xt.lifecycle.writeKey.value,xt.lifecycle.dataPlaneUrl.value);const{logLevel:e,configUrl:t,lockIntegrationsVersion:n,lockPluginsVersion:i,destSDKBaseURL:r,pluginsSDKBaseURL:s,integrations:o}=xt.loadOptions.value;xt.lifecycle.activeDataplaneUrl.value=Vn(xt.lifecycle.dataPlaneUrl.value);const a=((e,t,n)=>li("integrations",ot,gt,e,t,n))(ce,n,r),l=((e,t,n)=>li("plugins",at,ht,e,t,n))(ce,i,s);ri(this.logger),si(this.logger),oi(this.logger),Re((()=>{xt.lifecycle.integrationsCDNPath.value=a,xt.lifecycle.pluginsCDNPath.value=l,e&&(xt.lifecycle.logLevel.value=e),xt.lifecycle.sourceConfigUrl.value=ai(t,xt.lifecycle.writeKey.value,n,i,this.logger),xt.metrics.metricsServiceUrl.value=`${xt.lifecycle.activeDataplaneUrl.value}/rsaMetrics`,xt.nativeDestinations.loadOnlyIntegrations.value=o})),this.getConfig()}onError(e,t,n){if(!this.hasErrorHandler)throw e;this.errorHandler?.onError(e,G,t,n)}processConfig(e,t){if(!e)return void this.onError((n=t?.error,`Failed to fetch the source config. Reason: ${n}`));var n;let i;try{i=E(e)?JSON.parse(e):e}catch(e){return void this.onError(e,tt,!0)}if(!(e=>D(e)&&D(e.source)&&!I(e.source.id)&&D(e.source.config)&&Array.isArray(e.source.destinations))(i))return void this.onError(new Error(tt),void 0,!0);if(!1===i.source.enabled)return void this.logger?.error("The source is disabled. Please enable the source in the dashboard to send events.");ni(i);const r=i.source.destinations.length>0?(e=>{const t=[];return e.forEach((e=>{e.enabled&&!e.deleted&&t.push({id:e.id,displayName:e.destinationDefinition.displayName,config:e.config,shouldApplyDeviceModeTransformation:e.shouldApplyDeviceModeTransformation||!1,propagateEventsUntransformedOnError:e.propagateEventsUntransformedOnError||!1,userFriendlyId:`${e.destinationDefinition.displayName.replaceAll(" ","-")}___${e.id}`})})),t})(i.source.destinations):[];Re((()=>{xt.source.value={config:i.source.config,id:i.source.id,workspaceId:i.source.workspaceId},xt.nativeDestinations.configuredDestinations.value=r,xt.plugins.pluginsToLoadFromConfig.value=xt.loadOptions.value.plugins??[],(e=>{let t,n=xt.consents.resolutionStrategy.value;D(e.consentManagementMetadata)&&(xt.consents.provider.value&&(n=e.consentManagementMetadata.providers.find((e=>e.provider===xt.consents.provider.value))?.resolutionStrategy??xt.consents.resolutionStrategy.value),t=e.consentManagementMetadata),"custom"===xt.consents.provider.value&&(n=void 0),Re((()=>{xt.consents.metadata.value=g(t),xt.consents.resolutionStrategy.value=n}))})(i),xt.lifecycle.status.value="configured"}))}getConfig(){const e=xt.loadOptions.value.getSourceConfig;if(e){if(!b(e))throw new Error('"getSourceConfig" must be a function. Please make sure that it is defined and returns a valid source configuration object.');const t=e();t instanceof Promise?t.then((e=>this.processConfig(e))).catch((e=>{this.onError(e,"SourceConfig")})):this.processConfig(t)}else this.httpClient.getAsyncData({url:xt.lifecycle.sourceConfigUrl.value,options:{headers:{"Content-Type":void 0}},callback:this.processConfig})}}const ci=()=>document?.referrer||"$direct",di=()=>{const e=(()=>{const e=document.getElementsByTagName("link");let t="";for(let n=0;e[n];n+=1){const i=e[n];if("canonical"===i.getAttribute("rel")&&!t){t=i.getAttribute("href")??"";break}}return t})();let t=globalThis.location.pathname;const{href:n}=globalThis.location;let i=n;const{search:r}=globalThis.location;if(e)try{const n=new URL(e);i=""===n.search?e+r:e,t=n.pathname}catch(e){}const s=(e=>{let t=e;try{const n=new URL(e);t=n.origin+n.pathname+n.search}catch(e){}return t})(i),{title:o}=document,a=ci();return{path:t,referrer:a,referring_domain:Wn(a),search:r,title:o,url:s,tab_url:n}},gi=`https://polyfill-fastly.io/v3/polyfill.min.js?version=3.111.0&features=${Object.keys(Tn).join("%2C")}`,hi="rudderstackPolyfill";class pi{constructor(e,t){this.logger=t,this.errorHandler=e,this.externalSrcLoader=new Ce(this.errorHandler,this.logger),this.onError=this.onError.bind(this),this.onReady=this.onReady.bind(this)}init(){try{this.prepareBrowserCapabilities(),this.attachWindowListeners()}catch(e){this.onError(e)}}detectBrowserCapabilities(){Re((()=>{xt.capabilities.storage.isCookieStorageAvailable.value=Pn(ln,jn(ln),this.logger),xt.capabilities.storage.isLocalStorageAvailable.value=Pn(un,void 0,this.logger),xt.capabilities.storage.isSessionStorageAvailable.value=Pn(cn,void 0,this.logger),xt.capabilities.isBeaconAvailable.value=!I(globalThis.navigator.sendBeacon)&&b(globalThis.navigator.sendBeacon),xt.capabilities.isUaCHAvailable.value=In(),xt.capabilities.isCryptoAvailable.value=!I(globalThis.crypto)&&b(globalThis.crypto.getRandomValues),xt.capabilities.isIE11.value=Boolean(globalThis.navigator.userAgent.match(/Trident.*rv:11\./)),xt.capabilities.isOnline.value=globalThis.navigator.onLine,xt.context.userAgent.value=(()=>{if(S(globalThis.navigator))return null;let{userAgent:e}=globalThis.navigator;const{brave:t}=globalThis.navigator;if(t&&Object.getPrototypeOf(t).isBrave){const t=e.match(/(chrome)\/([\w.]+)/i);t&&(e=`${e} Brave/${t[2]}`)}return e})(),xt.context.locale.value=S(globalThis.navigator)?null:globalThis.navigator.language??globalThis.navigator.browserLanguage,xt.context.screen.value=wn(),xt.context.timezone.value=(()=>{const e=(new Date).toString().match(/([A-Z]+[+-]\d+)/);return e&&e[1]?e[1]:"NA"})(),In()&&((e,t="none")=>{"none"===t&&e(void 0),"default"===t&&e(navigator.userAgentData),"full"===t&&navigator.userAgentData?.getHighEntropyValues(["architecture","bitness","brands","mobile","model","platform","platformVersion","uaFullVersion","fullVersionList","wow64"]).then((t=>{e(t)})).catch((()=>{e()}))})((e=>{xt.context["ua-ch"].value=e}),xt.loadOptions.value.uaChTrackLevel)})),qe((()=>{!0===xt.loadOptions.value.sendAdblockPage&&void 0!==xt.lifecycle.sourceConfigUrl.value&&((e,t)=>{const n=new URL(xt.lifecycle.sourceConfigUrl.value),i=`${n.origin}${n.pathname}?view=ad`,r=new on(e,t);r.setAuthHeader(xt.lifecycle.writeKey.value),r.getAsyncData({url:i,options:{method:"HEAD",headers:{"Content-Type":void 0}},isRawResponse:!0,callback:(e,t)=>{xt.capabilities.isAdBlocked.value=void 0!==t?.error||t?.xhr?.responseURL!==i}})})(this.errorHandler,this.logger)}))}prepareBrowserCapabilities(){xt.capabilities.isLegacyDOM.value=(()=>{const e=Object.keys(Tn);let t=!1;for(let n=0;n<e.length;n++){const i=Tn[e[n]];if(b(i)&&i()){t=!0;break}}return t})();const e=xt.loadOptions.value.polyfillURL;let t=gi;w(e)&&(Qn(e)?t=e:this.logger?.warn(((e,t)=>`${e}${Se}The provided polyfill URL "${t}" is invalid. The default polyfill URL will be used instead.`)(K,e)));if(xt.loadOptions.value.polyfillIfRequired&&xt.capabilities.isLegacyDOM.value&&Qn(t)){const e=t!==xt.loadOptions.value.polyfillURL;if(e){const e=`RS_polyfillCallback_${xt.lifecycle.writeKey.value}`,n=()=>{this.onReady(),delete globalThis[e]};globalThis[e]=n,t=`${t}&callback=${e}`}this.externalSrcLoader.loadJSFile({url:t,id:hi,async:!0,timeout:1e4,callback:n=>{n?e||this.onReady():this.onError(new Error(((e,t)=>`Failed to load the polyfill script with ID "${e}" from URL ${t}.`)(hi,t)))}})}else this.onReady()}attachWindowListeners(){globalThis.addEventListener("offline",(()=>{xt.capabilities.isOnline.value=!1})),globalThis.addEventListener("online",(()=>{xt.capabilities.isOnline.value=!0})),globalThis.addEventListener("resize",function(e,t,n=250){let i;return(...r)=>{globalThis.clearTimeout(i),i=globalThis.setTimeout((()=>{e.apply(t,r)}),n)}}((()=>{xt.context.screen.value=wn()}),this))}onReady(){this.detectBrowserCapabilities(),xt.lifecycle.status.value="browserCapabilitiesReady"}onError(e){if(!this.errorHandler)throw e;this.errorHandler.onError(e,K)}}const vi=["integrations","anonymousId","originalTimestamp"],fi=["library","consentManagement","userAgent","ua-ch","screen"],yi=["id","anonymous_id","user_id","sent_at","timestamp","received_at","original_timestamp","event","event_text","channel","context_ip","context_request_ip","context_passed_ip","group_id","previous_id"],mi=e=>"number"==typeof e&&!Number.isNaN(e),bi=e=>mi(e)&&e>=0&&Number.isInteger(e),Ei=e=>{const t=Date.now();return Boolean(!e||t>e)},ki=(e,t)=>{return!!(e&&bi(e)&&(n=10,i=e,i.toString().length>=n))||(t?.warn(((e,t,n)=>`${e}${Se}The provided session ID (${t}) is either invalid, not a positive integer, or not at least "${n}" digits long. A new session ID will be auto-generated instead.`)(q,e,10)),!1);var n,i},Si=(e,t)=>({id:ki(e,t)?e:Date.now(),sessionStart:void 0,manualTrack:!0}),Ii=e=>Boolean(e===ln||e===un||e===cn||e===dn),Ti=()=>ae(),wi=e=>{const t=di(),n={};return Object.keys(t).forEach((i=>{n[i]=e?.[i]||t[i]})),n.initial_referrer=e?.initial_referrer||xt.session.initialReferrer.value,n.initial_referring_domain=e?.initial_referring_domain||xt.session.initialReferringDomain.value,n},Ai=(e,t,n)=>{D(e)&&Object.keys(e).forEach((e=>{(yi.includes(e)||yi.includes(e.toLowerCase()))&&n?.warn(((e,t,n,i)=>`${e}${Se}The "${t}" property defined under "${n}" is a reserved keyword. Please choose a different property name to avoid conflicts with reserved keywords (${i}).`)(z,e,t,yi))}))},Pi=(e,t)=>{D(t)&&(((e,t)=>{t.anonymousId&&E(t.anonymousId)&&(e.anonymousId=t.anonymousId),O(t.integrations)&&(e.integrations=t.integrations),t.originalTimestamp&&E(t.originalTimestamp)&&(e.originalTimestamp=t.originalTimestamp)})(e,t),e.context=((e,t,n)=>{let i=e;return Object.keys(t).forEach((e=>{if(!vi.includes(e)&&!fi.includes(e))if("context"!==e)i=R(i,{[e]:t[e]});else if(!S(t[e])&&D(t[e])){const n={};Object.keys(t[e]).forEach((i=>{fi.includes(i)||(n[i]=t[e][i])})),i=R(i,{...n})}})),i})(e.context,t))},Ci=(e,t,n,i)=>{const r={channel:"web",context:{traits:g(xt.session.userTraits.value),sessionId:xt.session.sessionInfo.value.id||void 0,sessionStart:xt.session.sessionInfo.value.sessionStart||void 0,...xt.consents.enabled.value&&{consentManagement:{deniedConsentIds:g(xt.consents.data.value.deniedConsentIds),allowedConsentIds:g(xt.consents.data.value.allowedConsentIds),provider:xt.consents.provider.value,resolutionStrategy:xt.consents.resolutionStrategy.value}},"ua-ch":xt.context["ua-ch"].value,app:xt.context.app.value,library:xt.context.library.value,userAgent:xt.context.userAgent.value,os:xt.context.os.value,locale:xt.context.locale.value,screen:xt.context.screen.value,campaign:Jn(globalThis.location.href),page:wi(n),timezone:xt.context.timezone.value,...xt.autoTrack.enabled.value&&{autoTrack:{...xt.autoTrack.pageLifecycle.enabled.value&&{page:{visitId:xt.autoTrack.pageLifecycle.visitId.value}}}}},originalTimestamp:le(new Date),messageId:ae(),userId:e.userId||xt.session.userId.value};Ii(xt.storage.entries.value.anonymousId?.type)?r.anonymousId=xt.session.anonymousId.value:r.anonymousId=Ti(),xt.storage.trulyAnonymousTracking.value&&(r.context.trulyAnonymousTracking=!0),"identify"===e.type&&(r.context.traits=xt.storage.entries.value.userTraits?.type!==gn?g(xt.session.userTraits.value):e.context.traits),"group"===e.type&&((e.groupId||xt.session.groupId.value)&&(r.groupId=e.groupId||xt.session.groupId.value),(e.traits||xt.session.groupTraits.value)&&(r.traits=xt.storage.entries.value.groupTraits?.type!==gn?g(xt.session.groupTraits.value):e.traits));const s=R(e,r);return void 0===s.event&&(s.event=null),void 0===s.properties&&(s.properties=null),Pi(s,t),((e,t)=>{const{properties:n,traits:i,context:r}=e,{traits:s}=r;Ai(n,"properties",t),Ai(i,"traits",t),Ai(s,"context.traits",t)})(s,i),s.integrations=(e=>{let t;return t=xt.loadOptions.value.useGlobalIntegrationsConfigInEvents?xt.consents.postConsent.value.integrations??xt.nativeDestinations.loadOnlyIntegrations.value:e||st,g(t)})(s.integrations),s};class Di{constructor(e){this.logger=e}generatePageEvent(e,t,n,i){let r=n??{};r=((e,t)=>{const n=t?.page||{},i=e,r=di();return Object.keys(r).forEach((e=>{S(i[e])&&(i[e]=n[e]||r[e])})),S(i.initial_referrer)&&(i.initial_referrer=n.initial_referrer||xt.session.initialReferrer.value),S(i.initial_referring_domain)&&(i.initial_referring_domain=n.initial_referring_domain||xt.session.initialReferringDomain.value),i})(r,i);return Ci({properties:r,name:t,category:e,type:"page"},i,r,this.logger)}generateTrackEvent(e,t,n){return Ci({properties:t,event:e,type:"track"},n,void 0,this.logger)}generateIdentifyEvent(e,t,n){return Ci({userId:e,type:"identify",context:{traits:t}},n,void 0,this.logger)}generateAliasEvent(e,t,n){const i=Ci({previousId:t,type:"alias"},n,void 0,this.logger);return i.userId=e??i.userId,i}generateGroupEvent(e,t,n){const i={type:"group"};return e&&(i.groupId=e),t&&(i.traits=t),Ci(i,n,void 0,this.logger)}create(e){let t;switch(e.type){case"page":t=this.generatePageEvent(e.category,e.name,e.properties,e.options);break;case"track":t=this.generateTrackEvent(e.name,e.properties,e.options);break;case"identify":t=this.generateIdentifyEvent(e.userId,e.traits,e.options);break;case"alias":t=this.generateAliasEvent(e.to,e.from,e.options);break;case"group":t=this.generateGroupEvent(e.groupId,e.traits,e.options)}return t}}class $i{constructor(e,t,n,i){this.eventRepository=e,this.userSessionManager=t,this.errorHandler=n,this.logger=i,this.eventFactory=new Di(this.logger),this.onError=this.onError.bind(this)}init(){this.eventRepository.init()}resume(){this.eventRepository.resume()}addEvent(e){this.userSessionManager.refreshSession();const t=this.eventFactory.create(e);t?this.eventRepository.enqueue(t,e.callback):this.onError(new Error("Failed to generate the event object."))}onError(e,t,n){if(!this.errorHandler)throw e;this.errorHandler.onError(e,z,t,n)}}class Ri{constructor(e,t,n,i,r){this.storeManager=i,this.pluginsManager=n,this.logger=t,this.errorHandler=e,this.httpClient=r,this.onError=this.onError.bind(this),this.serverSideCookieDebounceFuncs={}}init(){this.syncStorageDataToState(),this.registerEffects()}syncStorageDataToState(){this.migrateStorageIfNeeded(),this.migrateDataFromPreviousStorage(),this.setUserId(this.getUserId()),this.setUserTraits(this.getUserTraits()),this.setGroupId(this.getGroupId()),this.setGroupTraits(this.getGroupTraits());const{externalAnonymousIdCookieName:e,anonymousIdOptions:t}=xt.loadOptions.value;let n;w(e)&&"string"==typeof e&&(n=this.getExternalAnonymousIdByCookieName(e)),this.setAnonymousId(n??this.getAnonymousId(t)),this.setAuthToken(this.getAuthToken()),this.setInitialReferrerInfo(),this.configureSessionTracking()}configureSessionTracking(){let e=this.getSessionInfo();if(this.isPersistenceEnabledForStorageEntry("sessionInfo")){const t=this.getConfiguredSessionTrackingInfo(),n=e??St;e={...n,...t,autoTrack:t.autoTrack&&!0!==n.manualTrack},e.autoTrack||!0===e.manualTrack||(e=kt.sessionInfo)}else e=kt.sessionInfo;xt.session.sessionInfo.value=e,xt.session.sessionInfo.value.autoTrack&&this.startOrRenewAutoTracking(xt.session.sessionInfo.value)}setInitialReferrerInfo(){const e=this.getInitialReferrer(),t=this.getInitialReferringDomain();if(e&&t)this.setInitialReferrer(e),this.setInitialReferringDomain(t);else{const t=e||ci();this.setInitialReferrer(t),this.setInitialReferringDomain(Wn(t))}}isPersistenceEnabledForStorageEntry(e){return Ii(xt.storage.entries.value[e]?.type)}migrateDataFromPreviousStorage(){const e=xt.storage.entries.value,t=[ln,un,cn];Object.keys(e).forEach((n=>{const i=n,r=e[i]?.type,s=this.storeManager?.getStore(mn[r]);s&&t.forEach((e=>{const t=this.storeManager?.getStore(mn[e]);if(t&&e!==r){const e=t.get(hn[i]);(e=>w(e)&&""!==e)(e)&&s.set(hn[i],e),t.remove(hn[i])}}))}))}migrateStorageIfNeeded(){if(!xt.storage.migrate.value)return;const e=[];[pn,vn,fn].forEach((t=>{const n=this.storeManager?.getStore(t);n&&e.push(n)})),Object.keys(hn).forEach((t=>{const n=hn[t];e.forEach((e=>{const t=this.pluginsManager?.invokeSingle("storage.migrate",n,e.engine,this.errorHandler,this.logger);I(t)||e.set(n,t)}))}))}getConfiguredSessionTrackingInfo(){let e,t=!1!==xt.loadOptions.value.sessions?.autoTrack;if(!t)return{autoTrack:t};const n=xt.loadOptions.value.sessions?.timeout;return bi(n)?e=n:(this.logger?.warn(((e,t,n)=>`${e}${Se}The session timeout value "${t}" is not a number. The default timeout of ${n} ms will be used instead.`)(q,n,fe)),e=fe),0===e&&(this.logger?.warn(`${q}${Se}The session timeout value is 0, which disables the automatic session tracking feature. If you want to enable session tracking, please provide a positive integer value for the timeout.`),t=!1),e>0&&e<1e4&&this.logger?.warn(((e,t,n)=>`${e}${Se}The session timeout value ${t} ms is less than the recommended minimum of ${n} ms. Please consider increasing the timeout value to ensure optimal performance and reliability.`)(q,e,1e4)),{timeout:e,autoTrack:t}}onError(e,t){if(!this.errorHandler)throw e;this.errorHandler.onError(e,q,t)}getEncryptedCookieData(e,t){const n=[];return e.forEach((e=>{const i=t?.encrypt(we(e.value,!1,[],this.logger));w(i)&&n.push({name:e.name,value:i})})),n}makeRequestToSetCookie(e,t){this.httpClient?.getAsyncData({url:xt.serverCookies.dataServiceUrl.value,options:{method:"POST",data:we({reqType:"setCookies",workspaceId:xt.source.value?.workspaceId,data:{options:{maxAge:xt.storage.cookie.value?.maxage,path:xt.storage.cookie.value?.path,domain:xt.storage.cookie.value?.domain,sameSite:xt.storage.cookie.value?.samesite,secure:xt.storage.cookie.value?.secure,expires:xt.storage.cookie.value?.expires},cookies:e}}),sendRawData:!0,withCredentials:!0},isRawResponse:!0,callback:t})}setServerSideCookies(e,t,n){try{const i=this.getEncryptedCookieData(e,n);i.length>0&&this.makeRequestToSetCookie(i,((i,r)=>{var s;200===r?.xhr?.status?e.forEach((e=>{const i=n?.get(e.name),r=we(e.value,!1,[]);we(i,!1,[])!==r&&(this.logger?.error(`The server failed to set the ${e.name} cookie. As a fallback, the cookies will be set client side.`),t&&t(e.name,e.value))})):(this.logger?.error((s=r?.xhr?.status,`The server responded with status ${s} while setting the cookies. As a fallback, the cookies will be set client side.`)),e.forEach((e=>{t&&t(e.name,e.value)})))}))}catch(n){this.onError(n,"Failed to set/remove cookies via server. As a fallback, the cookies will be managed client side."),e.forEach((e=>{t&&t(e.name,e.value)}))}}syncValueToStorage(e,t){const n=xt.storage.entries.value,i=n[e]?.type;if(Ii(i)){const r=this.storeManager?.getStore(mn[i]),s=n[e]?.key;t&&(E(t)||O(t))?xt.serverCookies.isEnabledServerSideCookies.value&&i===ln?(this.serverSideCookieDebounceFuncs[e]&&globalThis.clearTimeout(this.serverSideCookieDebounceFuncs[e]),this.serverSideCookieDebounceFuncs[e]=globalThis.setTimeout((()=>{this.setServerSideCookies([{name:s,value:t}],((e,t)=>{r?.set(e,t)}),r)}),10)):r?.set(s,t):r?.remove(s)}}registerEffects(){yn.forEach((e=>{qe((()=>{this.syncValueToStorage(e,xt.session[e].value)}))}))}setAnonymousId(e,t){let n=e;if(this.isPersistenceEnabledForStorageEntry("anonymousId")){if(!n&&t){const e=this.pluginsManager?.invokeSingle("userSession.anonymousIdGoogleLinker",t);n=e}n=n||Ti()}else n=kt.anonymousId;xt.session.anonymousId.value=n}getAnonymousId(e){const t=xt.storage.entries.value.anonymousId?.type;if(Ii(t)){let t=this.getEntryValue("anonymousId");if(!t&&e){const n=this.pluginsManager?.invokeSingle("storage.getAnonymousId",jn,e);t=n}xt.session.anonymousId.value=t||Ti()}return xt.session.anonymousId.value}getEntryValue(e){const t=xt.storage.entries.value,n=t[e]?.type;if(Ii(n)){const i=this.storeManager?.getStore(mn[n]),r=t[e]?.key;return i?.get(r)??null}return null}getExternalAnonymousIdByCookieName(e){const t=jn(ln);return t?.isEnabled?t.getItem(e)??null:null}getUserId(){return this.getEntryValue("userId")}getUserTraits(){return this.getEntryValue("userTraits")}getGroupId(){return this.getEntryValue("groupId")}getGroupTraits(){return this.getEntryValue("groupTraits")}getInitialReferrer(){return this.getEntryValue("initialReferrer")}getInitialReferringDomain(){return this.getEntryValue("initialReferringDomain")}getSessionInfo(){return this.getEntryValue("sessionInfo")}getAuthToken(){return this.getEntryValue("authToken")}getSessionId(){const e=this.getSessionInfo()??kt.sessionInfo;return e.autoTrack&&!Ei(e.expiresAt)||e.manualTrack?e.id??null:null}refreshSession(){let e=this.getSessionInfo()??kt.sessionInfo;(e.autoTrack||e.manualTrack)&&(e.autoTrack&&(this.startOrRenewAutoTracking(e),e=xt.session.sessionInfo.value),void 0===e.sessionStart?e={...e,sessionStart:!0}:e.sessionStart&&(e={...e,sessionStart:!1})),xt.session.sessionInfo.value=e,"readyExecuted"!==xt.lifecycle.status.value&&this.syncValueToStorage("sessionInfo",e)}reset(e,t){const{session:n}=xt,{manualTrack:i,autoTrack:r}=n.sessionInfo.value;Re((()=>{n.userId.value=kt.userId,n.userTraits.value=kt.userTraits,n.groupId.value=kt.groupId,n.groupTraits.value=kt.groupTraits,n.authToken.value=kt.authToken,e&&this.setAnonymousId(),t||(r?(n.sessionInfo.value=kt.sessionInfo,this.startOrRenewAutoTracking(n.sessionInfo.value)):i&&this.startManualTrackingInternal())}))}setUserId(e){xt.session.userId.value=this.isPersistenceEnabledForStorageEntry("userId")&&e?e:kt.userId}setUserTraits(e){xt.session.userTraits.value=this.isPersistenceEnabledForStorageEntry("userTraits")&&D(e)?R(xt.session.userTraits.value??kt.userTraits,e):kt.userTraits}setGroupId(e){xt.session.groupId.value=this.isPersistenceEnabledForStorageEntry("groupId")&&e?e:kt.groupId}setGroupTraits(e){xt.session.groupTraits.value=this.isPersistenceEnabledForStorageEntry("groupTraits")&&D(e)?R(xt.session.groupTraits.value??kt.groupTraits,e):kt.groupTraits}setInitialReferrer(e){xt.session.initialReferrer.value=this.isPersistenceEnabledForStorageEntry("initialReferrer")&&e?e:kt.initialReferrer}setInitialReferringDomain(e){xt.session.initialReferringDomain.value=this.isPersistenceEnabledForStorageEntry("initialReferringDomain")&&e?e:kt.initialReferringDomain}startOrRenewAutoTracking(e){if(Ei(e.expiresAt))xt.session.sessionInfo.value=(e=>{const t=Date.now(),n=e||fe;return{id:t,expiresAt:t+n,timeout:n,sessionStart:void 0,autoTrack:!0}})(e.timeout);else{const t=Date.now(),n=e.timeout;xt.session.sessionInfo.value=R(e,{expiresAt:t+n})}}start(e){xt.session.sessionInfo.value=Si(e,this.logger)}startManualTrackingInternal(){this.start(Date.now())}end(){xt.session.sessionInfo.value=kt.sessionInfo}setAuthToken(e){xt.session.authToken.value=this.isPersistenceEnabledForStorageEntry("authToken")&&e?e:kt.authToken}}const Oi=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","IubendaConsentManager","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],Li="dataplaneEventsQueue",Mi="destinationsEventsQueue",Bi=(e,t)=>{const n=g(e),i=t.nativeDestinations.integrationsConfig.value,r=((e,t)=>Object.keys(e).filter((n=>!0!==e[n]||!t[n])).reduce(((t,n)=>{const i=g(t);return i[n]=e[n],i}),{}))(e.integrations,i);return n.integrations=R(i,r),n};class Ni{constructor(e,t,n,i){this.pluginsManager=e,this.errorHandler=n,this.logger=i,this.httpClient=new on(n,i),this.storeManager=t,this.onError=this.onError.bind(this)}init(){try{this.dataplaneEventsQueue=this.pluginsManager.invokeSingle(`${Li}.init`,xt,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(e){this.onError(e,"XhrQueuePlugin initialization failed")}try{this.dmtEventsQueue=this.pluginsManager.invokeSingle("transformEvent.init",xt,this.pluginsManager,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(e){this.onError(e,"DeviceModeTransformationPlugin initialization failed")}try{this.destinationsEventsQueue=this.pluginsManager.invokeSingle(`${Mi}.init`,xt,this.pluginsManager,this.storeManager,this.dmtEventsQueue,this.errorHandler,this.logger)}catch(e){this.onError(e,"NativeDestinationQueuePlugin initialization failed")}qe((()=>{!0===xt.nativeDestinations.clientDestinationsReady.value&&(this.destinationsEventsQueue?.start(),this.dmtEventsQueue?.start())}));const e=(e=>e.consents.preConsent.value.enabled&&"buffer"===e.consents.preConsent.value.events?.delivery&&("session"===e.consents.preConsent.value.storage?.strategy||"none"===e.consents.preConsent.value.storage?.strategy))(xt);let t;qe((()=>{const n=!0===xt.loadOptions.value.bufferDataPlaneEventsUntilReady&&!1===xt.nativeDestinations.clientDestinationsReady.value;!1!==xt.nativeDestinations.activeDestinations.value.some((e=>{return t=e,Boolean("hybrid"===t.config.connectionMode||!0===t.config.useNativeSDKToSend);var t}))&&!1!==n||e||!0===this.dataplaneEventsQueue?.scheduleTimeoutActive||(globalThis.clearTimeout(t),this.dataplaneEventsQueue?.start())})),!0===xt.loadOptions.value.bufferDataPlaneEventsUntilReady&&(t=globalThis.setTimeout((()=>{!0!==this.dataplaneEventsQueue?.scheduleTimeoutActive&&this.dataplaneEventsQueue?.start()}),xt.loadOptions.value.dataPlaneEventsBufferTimeout))}resume(){!0!==this.dataplaneEventsQueue?.scheduleTimeoutActive&&(xt.consents.postConsent.value.discardPreConsentEvents&&(this.dataplaneEventsQueue?.clear(),this.destinationsEventsQueue?.clear()),this.dataplaneEventsQueue?.start())}enqueue(e,t){let n;try{n=Bi(e,xt),this.pluginsManager.invokeSingle(`${Li}.enqueue`,xt,this.dataplaneEventsQueue,n,this.errorHandler,this.logger)}catch(e){this.onError(e,"XhrQueuePlugin event enqueue failed")}try{const t=g(e);this.pluginsManager.invokeSingle(`${Mi}.enqueue`,xt,this.destinationsEventsQueue,t,this.errorHandler,this.logger)}catch(e){this.onError(e,"NativeDestinationQueuePlugin event enqueue failed")}try{t?.(n)}catch(e){this.onError(e,"API Callback Invocation Failed")}}onError(e,t,n){if(!this.errorHandler)throw e;this.errorHandler.onError(e,"EventRepository",t,n)}}const Ui=e=>{const t=new CustomEvent(e,{detail:{analyticsInstance:globalThis.rudderanalytics},bubbles:!0,cancelable:!0,composed:!0});globalThis.document.dispatchEvent(t)};class xi{constructor(){this.preloadBuffer=new We,this.initialized=!1,this.errorHandler=Ht,this.logger=Xe,this.externalSrcLoader=new Ce(this.errorHandler,this.logger),this.capabilitiesManager=new pi(this.errorHandler,this.logger),this.httpClient=an}load(e,t,n={}){if(xt.lifecycle.status.value)return;let i=g(t),r=g(n);C(t)&&(r=t,i=void 0),Re((()=>{xt.lifecycle.writeKey.value=e,xt.lifecycle.dataPlaneUrl.value=i,xt.loadOptions.value=((e,t)=>{const n=g(t);return E(n.setCookieDomain)||delete n.setCookieDomain,["Strict","Lax","None"].includes(n.sameSiteCookie)||delete n.sameSiteCookie,n.secureCookie=!0===n.secureCookie,n.sameDomainCookiesOnly=!0===n.sameDomainCookiesOnly,["none","default","full"].includes(n.uaChTrackLevel)||delete n.uaChTrackLevel,O(n.integrations)||delete n.integrations,n.plugins=n.plugins??Oi,n.useGlobalIntegrationsConfigInEvents=!0===n.useGlobalIntegrationsConfigInEvents,n.bufferDataPlaneEventsUntilReady=!0===n.bufferDataPlaneEventsUntilReady,n.sendAdblockPage=!0===n.sendAdblockPage,n.useServerSideCookies=!0===n.useServerSideCookies,n.dataServiceEndpoint&&"string"!=typeof n.dataServiceEndpoint&&delete n.dataServiceEndpoint,D(n.sendAdblockPageOptions)||delete n.sendAdblockPageOptions,T(n.loadIntegration)?n.loadIntegration=!0===n.loadIntegration:delete n.loadIntegration,D(n.storage)?(n.storage=M(n.storage),n.storage.migrate=!0===n.storage?.migrate):delete n.storage,D(n.beaconQueueOptions)?n.beaconQueueOptions=M(n.beaconQueueOptions):delete n.beaconQueueOptions,D(n.destinationsQueueOptions)?n.destinationsQueueOptions=M(n.destinationsQueueOptions):delete n.destinationsQueueOptions,D(n.queueOptions)?n.queueOptions=M(n.queueOptions):delete n.queueOptions,n.lockIntegrationsVersion=!0===n.lockIntegrationsVersion,n.lockPluginsVersion=!0===n.lockPluginsVersion,mi(n.dataPlaneEventsBufferTimeout)||delete n.dataPlaneEventsBufferTimeout,D(n.storage?.cookie)?n.storage.cookie=M(n.storage?.cookie):delete n.storage?.cookie,D(n.preConsent)?n.preConsent=M(n.preConsent):delete n.preConsent,R(e,n)})(xt.loadOptions.value,r),xt.lifecycle.status.value="mounted"})),this.logger?.setMinLogLevel(xt.loadOptions.value.logLevel??"ERROR"),me("state",xt,e),this.startLifecycle()}startLifecycle(){qe((()=>{try{switch(xt.lifecycle.status.value){case"mounted":this.onMounted();break;case"browserCapabilitiesReady":this.onBrowserCapabilitiesReady();break;case"configured":this.onConfigured();break;case"pluginsLoading":case"destinationsLoading":case"readyExecuted":default:break;case"pluginsReady":this.onPluginsReady();break;case"initialized":this.onInitialized();break;case"loaded":this.onLoaded();break;case"destinationsReady":this.onDestinationsReady();break;case"ready":this.onReady()}}catch(e){const t="Failed to load the SDK";this.errorHandler.onError(Ae(e,t),Y)}}))}onBrowserCapabilitiesReady(){Ee(this),this.prepareInternalServices(),this.loadConfig()}onLoaded(){this.processBufferedEvents(),!0===xt.consents.preConsent.value.enabled?xt.lifecycle.status.value="ready":this.loadDestinations()}onMounted(){this.capabilitiesManager.init()}enqueuePreloadBufferEvents(e){Array.isArray(e)&&e.forEach((e=>this.preloadBuffer.enqueue(g(e))))}processDataInPreloadBuffer(){for(;this.preloadBuffer.size()>0;){const e=this.preloadBuffer.dequeue();e&&ke([...e],this)}}prepareInternalServices(){this.pluginsManager=new Yt(jt,this.errorHandler,this.logger),this.storeManager=new Fn(this.pluginsManager,this.errorHandler,this.logger),this.configManager=new ui(this.httpClient,this.errorHandler,this.logger),this.userSessionManager=new Ri(this.errorHandler,this.logger,this.pluginsManager,this.storeManager,this.httpClient),this.eventRepository=new Ni(this.pluginsManager,this.storeManager,this.errorHandler,this.logger),this.eventManager=new $i(this.eventRepository,this.userSessionManager,this.errorHandler,this.logger)}loadConfig(){xt.lifecycle.writeKey.value&&this.httpClient.setAuthHeader(xt.lifecycle.writeKey.value),this.configManager?.init()}onPluginsReady(){this.errorHandler.init(this.httpClient,this.externalSrcLoader),this.storeManager?.init(),this.userSessionManager?.init(),xt.consents.enabled.value&&!xt.consents.initialized.value&&(this.pluginsManager?.invokeSingle("consentManager.init",xt,this.logger),!1===xt.consents.preConsent.value.enabled&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",xt,this.storeManager,this.logger)),this.eventManager?.init(),xt.lifecycle.status.value="initialized"}onConfigured(){this.pluginsManager?.init()}onInitialized(){this.processDataInPreloadBuffer(),b(xt.loadOptions.value.onLoaded)&&xt.loadOptions.value.onLoaded(globalThis.rudderanalytics),Re((()=>{xt.lifecycle.loaded.value=!0,xt.lifecycle.status.value="loaded"})),this.initialized=!0,Ui("RSA_Initialised")}onReady(){xt.lifecycle.status.value="readyExecuted",xt.eventBuffer.readyCallbacksArray.value.forEach((e=>{try{e()}catch(e){this.errorHandler.onError(e,Y,rt)}})),Ui("RSA_Ready")}processBufferedEvents(){let e=xt.eventBuffer.toBeProcessedArray.value;for(;e.length>0;){const t=e.shift();if(xt.eventBuffer.toBeProcessedArray.value=e,t){const e=t[0];b(this[e])&&this[e](...t.slice(1),!0)}e=xt.eventBuffer.toBeProcessedArray.value}}loadDestinations(){if(xt.nativeDestinations.clientDestinationsReady.value)return;this.pluginsManager?.invokeSingle("nativeDestinations.setActiveDestinations",xt,this.pluginsManager,this.errorHandler,this.logger);const e=xt.nativeDestinations.activeDestinations.value.length;0!==e?(xt.lifecycle.status.value="destinationsLoading",this.pluginsManager?.invokeSingle("nativeDestinations.load",xt,this.externalSrcLoader,this.errorHandler,this.logger),qe((()=>{(0===e||xt.nativeDestinations.initializedDestinations.value.length+xt.nativeDestinations.failedDestinations.value.length===e)&&Re((()=>{xt.lifecycle.status.value="destinationsReady",xt.nativeDestinations.clientDestinationsReady.value=!0}))}))):xt.lifecycle.status.value="destinationsReady"}onDestinationsReady(){"ready"!==xt.lifecycle.status.value&&(xt.lifecycle.status.value="ready")}ready(e,t=!1){const n="ready";if(xt.lifecycle.loaded.value)if(this.errorHandler.leaveBreadcrumb(`New ${n} invocation`),b(e))if("readyExecuted"===xt.lifecycle.status.value)try{e()}catch(e){this.errorHandler.onError(e,Y,rt)}else xt.eventBuffer.readyCallbacksArray.value=[...xt.eventBuffer.readyCallbacksArray.value,e];else this.logger.error(`${"readyApi"}${Se}The callback is not a function.`);else xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]}page(e,t=!1){const n="page";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} event`),xt.metrics.triggered.value+=1,this.eventManager?.addEvent({type:"page",category:e.category,name:e.name,properties:e.properties,options:e.options,callback:e.callback}),!0===xt.capabilities.isAdBlocked.value&&e.category!==de&&this.page(x(de,"ad-block page request",{path:"/ad-blocked"},xt.loadOptions.value.sendAdblockPageOptions))):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]}track(e,t=!1){const n="track";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} event - ${e.name}`),xt.metrics.triggered.value+=1,this.eventManager?.addEvent({type:n,name:e.name||void 0,properties:e.properties,options:e.options,callback:e.callback})):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]}identify(e,t=!1){const n="identify";if(!xt.lifecycle.loaded.value)return void(xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]);this.errorHandler.leaveBreadcrumb(`New ${n} event`),xt.metrics.triggered.value+=1;Boolean(e.userId&&xt.session.userId.value&&e.userId!==xt.session.userId.value)&&this.reset(),k(e.userId)||this.userSessionManager?.setUserId(e.userId),this.userSessionManager?.setUserTraits(e.traits),this.eventManager?.addEvent({type:n,userId:e.userId,traits:e.traits,options:e.options,callback:e.callback})}alias(e,t=!1){const n="alias";if(!xt.lifecycle.loaded.value)return void(xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]);this.errorHandler.leaveBreadcrumb(`New ${n} event`),xt.metrics.triggered.value+=1;const i=e.from??this.userSessionManager?.getUserId()??this.userSessionManager?.getAnonymousId();this.eventManager?.addEvent({type:n,to:e.to,from:i,options:e.options,callback:e.callback})}group(e,t=!1){const n="group";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} event`),xt.metrics.triggered.value+=1,k(e.groupId)||this.userSessionManager?.setGroupId(e.groupId),this.userSessionManager?.setGroupTraits(e.traits),this.eventManager?.addEvent({type:n,groupId:e.groupId,traits:e.traits,options:e.options,callback:e.callback})):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]}reset(e,t=!1){const n="reset";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} invocation, resetAnonymousId: ${e}`),this.userSessionManager?.reset(e)):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]}getAnonymousId(e){return this.userSessionManager?.getAnonymousId(e)}setAnonymousId(e,t,n=!1){const i="setAnonymousId";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),this.userSessionManager?.setAnonymousId(e,t)):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[i,e,t]]}getUserId(){return xt.session.userId.value}getUserTraits(){return xt.session.userTraits.value}getGroupId(){return xt.session.groupId.value}getGroupTraits(){return xt.session.groupTraits.value}startSession(e,t=!1){const n="startSession";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${n} invocation`),this.userSessionManager?.start(e)):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[n,e]]}endSession(e=!1){const t="endSession";xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),this.userSessionManager?.end()):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,[t]]}getSessionId(){const e=this.userSessionManager?.getSessionId();return e??null}consent(e,t=!1){xt.lifecycle.loaded.value?(this.errorHandler.leaveBreadcrumb("New consent invocation"),Re((()=>{xt.consents.preConsent.value={...xt.consents.preConsent.value,enabled:!1},xt.consents.postConsent.value=(e=>{const t={sendPageEvent:!1,trackConsent:!1,discardPreConsentEvents:!1};if(D(e)){const n=g(e);t.storage=n.storage,O(n.integrations)&&(t.integrations=n.integrations),t.discardPreConsentEvents=!0===n.discardPreConsentEvents,t.sendPageEvent=!0===n.sendPageEvent,t.trackConsent=!0===n.trackConsent,O(n.consentManagement)&&(t.consentManagement=R(n.consentManagement,{enabled:xt.consents.enabled.value}))}return t})(e);const{initialized:t,consentsData:n}=ti(xt.consents.postConsent.value.consentManagement,this.logger);xt.consents.initialized.value=t||xt.consents.initialized.value,xt.consents.data.value=n})),xt.consents.enabled.value&&!xt.consents.initialized.value&&this.pluginsManager?.invokeSingle("consentManager.updateConsentsInfo",xt,this.storeManager,this.logger),this.storeManager?.initializeStorageState(),this.userSessionManager?.syncStorageDataToState(),this.eventManager?.resume(),this.loadDestinations(),this.sendTrackingEvents(t)):xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,["consent",e]]}sendTrackingEvents(e){if(xt.consents.postConsent.value.trackConsent){const t=j("Consent Management Interaction");e?xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,["track",t]]:this.track(t)}if(xt.consents.postConsent.value.sendPageEvent){const t=x();e?xt.eventBuffer.toBeProcessedArray.value=[...xt.eventBuffer.toBeProcessedArray.value,["page",t]]:this.page(t)}}setAuthToken(e){this.userSessionManager?.setAuthToken(e)}}class ji{static globalSingleton=null;analyticsInstances={};defaultAnalyticsKey="";logger=(()=>Xe)();constructor(){if(ji.globalSingleton)return ji.globalSingleton;Ht.attachErrorListeners(),this.setDefaultInstanceKey=this.setDefaultInstanceKey.bind(this),this.getAnalyticsInstance=this.getAnalyticsInstance.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.triggerBufferedLoadEvent=this.triggerBufferedLoadEvent.bind(this),this.page=this.page.bind(this),this.track=this.track.bind(this),this.identify=this.identify.bind(this),this.alias=this.alias.bind(this),this.group=this.group.bind(this),this.reset=this.reset.bind(this),this.getAnonymousId=this.getAnonymousId.bind(this),this.setAnonymousId=this.setAnonymousId.bind(this),this.getUserId=this.getUserId.bind(this),this.getUserTraits=this.getUserTraits.bind(this),this.getGroupId=this.getGroupId.bind(this),this.getGroupTraits=this.getGroupTraits.bind(this),this.startSession=this.startSession.bind(this),this.endSession=this.endSession.bind(this),this.getSessionId=this.getSessionId.bind(this),this.setAuthToken=this.setAuthToken.bind(this),this.consent=this.consent.bind(this),ji.globalSingleton=this,xt.autoTrack.pageLifecycle.visitId.value=ae(),xt.autoTrack.pageLifecycle.pageLoadedTimestamp.value=Date.now(),this.triggerBufferedLoadEvent(),globalThis.rudderanalytics=this}setDefaultInstanceKey(e){e&&(this.defaultAnalyticsKey=e)}getAnalyticsInstance(e){const t=e??this.defaultAnalyticsKey;return Boolean(this.analyticsInstances[t])||(this.analyticsInstances[t]=new xi),this.analyticsInstances[t]}load(e,t,n){if(!E(e))return void this.logger.error(((e,t)=>`${e}${Se}The write key "${t}" is not a string. Please check that the write key is correct and try again.`)(Z,e));if(this.analyticsInstances[e])return;this.setDefaultInstanceKey(e);const i=this.getPreloadedEvents();this.trackPageLifecycleEvents(i,n),(e=>{const t="consent",n=e.filter((e=>e[0]===t)),i=e.filter((e=>e[0]!==t));e.splice(0,e.length,...n,...i)})(i),me(ge,g(i)),this.analyticsInstances[e]=new xi,this.getAnalyticsInstance(e).load(e,t,n)}getPreloadedEvents(){return Array.isArray(globalThis.rudderanalytics)?globalThis.rudderanalytics:[]}trackPageLifecycleEvents(e,t){const{autoTrack:n,useBeacon:i}=t??{},{enabled:r=!1,options:s={},pageLifecycle:o}=n??{},{events:a=[Q.LOADED,Q.UNLOADED],enabled:l=r,options:u=s}=o??{};xt.autoTrack.pageLifecycle.enabled.value=l,xt.autoTrack.enabled.value=r||l,l&&(this.trackPageLoadedEvent(a,u,e),this.setupPageUnloadTracking(a,i,u))}trackPageLoadedEvent(e,t,n){(0===e.length||e.includes(Q.LOADED))&&n.unshift(["track",Q.LOADED,{},{...t,originalTimestamp:le(new Date(xt.autoTrack.pageLifecycle.pageLoadedTimestamp.value))}])}setupPageUnloadTracking(e,t,n){(0===e.length||e.includes(Q.UNLOADED))&&(!0===t?(e=>{let t=!1,n=!1;function i(){t||(t=!0,e(n),setTimeout((()=>{t=!1}),0))}globalThis.addEventListener("beforeunload",(()=>{n=!1,i()})),globalThis.addEventListener("blur",(()=>{n=!0,i()})),globalThis.addEventListener("focus",(()=>{t=!1})),document.addEventListener("pagehide",(()=>{n="hidden"===document.visibilityState,i()})),document.addEventListener("visibilitychange",(()=>{n=!0,"hidden"===document.visibilityState?i():t=!1}))})((e=>{if(!1===e&&xt.lifecycle.loaded.value){const e=Date.now(),t=e-xt.autoTrack.pageLifecycle.pageLoadedTimestamp.value;this.track(Q.UNLOADED,{visitDuration:t},{...n,originalTimestamp:le(new Date(e))})}})):this.logger.warn(`${Z}${Se}Page Unloaded event can only be tracked when the Beacon transport is active. Please enable "useBeacon" load API option.`))}triggerBufferedLoadEvent(){const e=this.getPreloadedEvents(),t=(e=>{let t=[],n=0;for(;n<e.length;){if(e[n]&&"load"===e[n][0]){t=g(e[n]),e.splice(n,1);break}n+=1}return t})(e);me(ge,g(e)),t.length>0&&(t.shift(),this.load.apply(null,t))}ready(e){this.getAnalyticsInstance().ready(e)}page(e,t,n,i,r){this.getAnalyticsInstance().page(x(e,t,n,i,r))}track(e,t,n,i){this.getAnalyticsInstance().track(j(e,t,n,i))}identify(e,t,n,i){this.getAnalyticsInstance().identify(H(e,t,n,i))}alias(e,t,n,i){this.getAnalyticsInstance().alias(_(e,t,n,i))}group(e,t,n,i){0!==arguments.length?this.getAnalyticsInstance().group(F(e,t,n,i)):this.logger.error(`${Z}${Se}The group() method must be called with at least one argument.`)}reset(e){this.getAnalyticsInstance().reset(e)}getAnonymousId(e){return this.getAnalyticsInstance().getAnonymousId(e)}setAnonymousId(e,t){this.getAnalyticsInstance().setAnonymousId(e,t)}getUserId(){return this.getAnalyticsInstance().getUserId()}getUserTraits(){return this.getAnalyticsInstance().getUserTraits()}getGroupId(){return this.getAnalyticsInstance().getGroupId()}getGroupTraits(){return this.getAnalyticsInstance().getGroupTraits()}startSession(e){return this.getAnalyticsInstance().startSession(e)}endSession(){return this.getAnalyticsInstance().endSession()}getSessionId(){return this.getAnalyticsInstance().getSessionId()}setAuthToken(e){return this.getAnalyticsInstance().setAuthToken(e)}consent(e){return this.getAnalyticsInstance().consent(e)}}const{setDefaultInstanceKey:Hi,getAnalyticsInstance:_i,load:Fi,ready:Qi,page:Ki,track:Gi,identify:zi,alias:Vi,group:qi,reset:Wi,getAnonymousId:Ji,setAnonymousId:Xi,getUserId:Zi,getUserTraits:Yi,getGroupId:er,getGroupTraits:tr,startSession:nr,endSession:ir,getSessionId:rr,consent:sr,setAuthToken:or}=new ji;return e.alias=Vi,e.consent=sr,e.endSession=ir,e.getAnalyticsInstance=_i,e.getAnonymousId=Ji,e.getGroupId=er,e.getGroupTraits=tr,e.getSessionId=rr,e.getUserId=Zi,e.getUserTraits=Yi,e.group=qi,e.identify=zi,e.load=Fi,e.page=Ki,e.ready=Qi,e.reset=Wi,e.setAnonymousId=Xi,e.setAuthToken=or,e.setDefaultInstanceKey=Hi,e.startSession=nr,e.track=Gi,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),e}({});
//# sourceMappingURL=rsa.min.js.map
